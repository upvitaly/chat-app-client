(function webpackUniversalModuleDefinition(root, factory) {
	if(typeof exports === 'object' && typeof module === 'object')
		module.exports = factory();
	else if(typeof define === 'function' && define.amd)
		define([], factory);
	else {
		var a = factory();
		for(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];
	}
})(global, function() {
return /******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
/******/ 		}
/******/ 	};
/******/
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function(exports) {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/
/******/ 	// create a fake namespace object
/******/ 	// mode & 1: value is a module id, require it
/******/ 	// mode & 2: merge all properties of value into the ns
/******/ 	// mode & 4: return value when already ns object
/******/ 	// mode & 8|1: behave like require
/******/ 	__webpack_require__.t = function(value, mode) {
/******/ 		if(mode & 1) value = __webpack_require__(value);
/******/ 		if(mode & 8) return value;
/******/ 		if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
/******/ 		var ns = Object.create(null);
/******/ 		__webpack_require__.r(ns);
/******/ 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
/******/ 		if(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
/******/ 		return ns;
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = "./src/index.js");
/******/ })
/************************************************************************/
/******/ ({

/***/ "./node_modules/xmldom/dom-parser.js":
/*!*******************************************!*\
  !*** ./node_modules/xmldom/dom-parser.js ***!
  \*******************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("function DOMParser(options){\r\n\tthis.options = options ||{locator:{}};\r\n\t\r\n}\r\nDOMParser.prototype.parseFromString = function(source,mimeType){\r\n\tvar options = this.options;\r\n\tvar sax =  new XMLReader();\r\n\tvar domBuilder = options.domBuilder || new DOMHandler();//contentHandler and LexicalHandler\r\n\tvar errorHandler = options.errorHandler;\r\n\tvar locator = options.locator;\r\n\tvar defaultNSMap = options.xmlns||{};\r\n\tvar entityMap = {'lt':'<','gt':'>','amp':'&','quot':'\"','apos':\"'\"}\r\n\tif(locator){\r\n\t\tdomBuilder.setDocumentLocator(locator)\r\n\t}\r\n\t\r\n\tsax.errorHandler = buildErrorHandler(errorHandler,domBuilder,locator);\r\n\tsax.domBuilder = options.domBuilder || domBuilder;\r\n\tif(/\\/x?html?$/.test(mimeType)){\r\n\t\tentityMap.nbsp = '\\xa0';\r\n\t\tentityMap.copy = '\\xa9';\r\n\t\tdefaultNSMap['']= 'http://www.w3.org/1999/xhtml';\r\n\t}\r\n\tdefaultNSMap.xml = defaultNSMap.xml || 'http://www.w3.org/XML/1998/namespace';\r\n\tif(source){\r\n\t\tsax.parse(source,defaultNSMap,entityMap);\r\n\t}else{\r\n\t\tsax.errorHandler.error(\"invalid doc source\");\r\n\t}\r\n\treturn domBuilder.doc;\r\n}\r\nfunction buildErrorHandler(errorImpl,domBuilder,locator){\r\n\tif(!errorImpl){\r\n\t\tif(domBuilder instanceof DOMHandler){\r\n\t\t\treturn domBuilder;\r\n\t\t}\r\n\t\terrorImpl = domBuilder ;\r\n\t}\r\n\tvar errorHandler = {}\r\n\tvar isCallback = errorImpl instanceof Function;\r\n\tlocator = locator||{}\r\n\tfunction build(key){\r\n\t\tvar fn = errorImpl[key];\r\n\t\tif(!fn && isCallback){\r\n\t\t\tfn = errorImpl.length == 2?function(msg){errorImpl(key,msg)}:errorImpl;\r\n\t\t}\r\n\t\terrorHandler[key] = fn && function(msg){\r\n\t\t\tfn('[xmldom '+key+']\\t'+msg+_locator(locator));\r\n\t\t}||function(){};\r\n\t}\r\n\tbuild('warning');\r\n\tbuild('error');\r\n\tbuild('fatalError');\r\n\treturn errorHandler;\r\n}\r\n\r\n//console.log('#\\n\\n\\n\\n\\n\\n\\n####')\r\n/**\r\n * +ContentHandler+ErrorHandler\r\n * +LexicalHandler+EntityResolver2\r\n * -DeclHandler-DTDHandler \r\n * \r\n * DefaultHandler:EntityResolver, DTDHandler, ContentHandler, ErrorHandler\r\n * DefaultHandler2:DefaultHandler,LexicalHandler, DeclHandler, EntityResolver2\r\n * @link http://www.saxproject.org/apidoc/org/xml/sax/helpers/DefaultHandler.html\r\n */\r\nfunction DOMHandler() {\r\n    this.cdata = false;\r\n}\r\nfunction position(locator,node){\r\n\tnode.lineNumber = locator.lineNumber;\r\n\tnode.columnNumber = locator.columnNumber;\r\n}\r\n/**\r\n * @see org.xml.sax.ContentHandler#startDocument\r\n * @link http://www.saxproject.org/apidoc/org/xml/sax/ContentHandler.html\r\n */ \r\nDOMHandler.prototype = {\r\n\tstartDocument : function() {\r\n    \tthis.doc = new DOMImplementation().createDocument(null, null, null);\r\n    \tif (this.locator) {\r\n        \tthis.doc.documentURI = this.locator.systemId;\r\n    \t}\r\n\t},\r\n\tstartElement:function(namespaceURI, localName, qName, attrs) {\r\n\t\tvar doc = this.doc;\r\n\t    var el = doc.createElementNS(namespaceURI, qName||localName);\r\n\t    var len = attrs.length;\r\n\t    appendElement(this, el);\r\n\t    this.currentElement = el;\r\n\t    \r\n\t\tthis.locator && position(this.locator,el)\r\n\t    for (var i = 0 ; i < len; i++) {\r\n\t        var namespaceURI = attrs.getURI(i);\r\n\t        var value = attrs.getValue(i);\r\n\t        var qName = attrs.getQName(i);\r\n\t\t\tvar attr = doc.createAttributeNS(namespaceURI, qName);\r\n\t\t\tthis.locator &&position(attrs.getLocator(i),attr);\r\n\t\t\tattr.value = attr.nodeValue = value;\r\n\t\t\tel.setAttributeNode(attr)\r\n\t    }\r\n\t},\r\n\tendElement:function(namespaceURI, localName, qName) {\r\n\t\tvar current = this.currentElement\r\n\t\tvar tagName = current.tagName;\r\n\t\tthis.currentElement = current.parentNode;\r\n\t},\r\n\tstartPrefixMapping:function(prefix, uri) {\r\n\t},\r\n\tendPrefixMapping:function(prefix) {\r\n\t},\r\n\tprocessingInstruction:function(target, data) {\r\n\t    var ins = this.doc.createProcessingInstruction(target, data);\r\n\t    this.locator && position(this.locator,ins)\r\n\t    appendElement(this, ins);\r\n\t},\r\n\tignorableWhitespace:function(ch, start, length) {\r\n\t},\r\n\tcharacters:function(chars, start, length) {\r\n\t\tchars = _toString.apply(this,arguments)\r\n\t\t//console.log(chars)\r\n\t\tif(chars){\r\n\t\t\tif (this.cdata) {\r\n\t\t\t\tvar charNode = this.doc.createCDATASection(chars);\r\n\t\t\t} else {\r\n\t\t\t\tvar charNode = this.doc.createTextNode(chars);\r\n\t\t\t}\r\n\t\t\tif(this.currentElement){\r\n\t\t\t\tthis.currentElement.appendChild(charNode);\r\n\t\t\t}else if(/^\\s*$/.test(chars)){\r\n\t\t\t\tthis.doc.appendChild(charNode);\r\n\t\t\t\t//process xml\r\n\t\t\t}\r\n\t\t\tthis.locator && position(this.locator,charNode)\r\n\t\t}\r\n\t},\r\n\tskippedEntity:function(name) {\r\n\t},\r\n\tendDocument:function() {\r\n\t\tthis.doc.normalize();\r\n\t},\r\n\tsetDocumentLocator:function (locator) {\r\n\t    if(this.locator = locator){// && !('lineNumber' in locator)){\r\n\t    \tlocator.lineNumber = 0;\r\n\t    }\r\n\t},\r\n\t//LexicalHandler\r\n\tcomment:function(chars, start, length) {\r\n\t\tchars = _toString.apply(this,arguments)\r\n\t    var comm = this.doc.createComment(chars);\r\n\t    this.locator && position(this.locator,comm)\r\n\t    appendElement(this, comm);\r\n\t},\r\n\t\r\n\tstartCDATA:function() {\r\n\t    //used in characters() methods\r\n\t    this.cdata = true;\r\n\t},\r\n\tendCDATA:function() {\r\n\t    this.cdata = false;\r\n\t},\r\n\t\r\n\tstartDTD:function(name, publicId, systemId) {\r\n\t\tvar impl = this.doc.implementation;\r\n\t    if (impl && impl.createDocumentType) {\r\n\t        var dt = impl.createDocumentType(name, publicId, systemId);\r\n\t        this.locator && position(this.locator,dt)\r\n\t        appendElement(this, dt);\r\n\t    }\r\n\t},\r\n\t/**\r\n\t * @see org.xml.sax.ErrorHandler\r\n\t * @link http://www.saxproject.org/apidoc/org/xml/sax/ErrorHandler.html\r\n\t */\r\n\twarning:function(error) {\r\n\t\tconsole.warn('[xmldom warning]\\t'+error,_locator(this.locator));\r\n\t},\r\n\terror:function(error) {\r\n\t\tconsole.error('[xmldom error]\\t'+error,_locator(this.locator));\r\n\t},\r\n\tfatalError:function(error) {\r\n\t\tconsole.error('[xmldom fatalError]\\t'+error,_locator(this.locator));\r\n\t    throw error;\r\n\t}\r\n}\r\nfunction _locator(l){\r\n\tif(l){\r\n\t\treturn '\\n@'+(l.systemId ||'')+'#[line:'+l.lineNumber+',col:'+l.columnNumber+']'\r\n\t}\r\n}\r\nfunction _toString(chars,start,length){\r\n\tif(typeof chars == 'string'){\r\n\t\treturn chars.substr(start,length)\r\n\t}else{//java sax connect width xmldom on rhino(what about: \"? && !(chars instanceof String)\")\r\n\t\tif(chars.length >= start+length || start){\r\n\t\t\treturn new java.lang.String(chars,start,length)+'';\r\n\t\t}\r\n\t\treturn chars;\r\n\t}\r\n}\r\n\r\n/*\r\n * @link http://www.saxproject.org/apidoc/org/xml/sax/ext/LexicalHandler.html\r\n * used method of org.xml.sax.ext.LexicalHandler:\r\n *  #comment(chars, start, length)\r\n *  #startCDATA()\r\n *  #endCDATA()\r\n *  #startDTD(name, publicId, systemId)\r\n *\r\n *\r\n * IGNORED method of org.xml.sax.ext.LexicalHandler:\r\n *  #endDTD()\r\n *  #startEntity(name)\r\n *  #endEntity(name)\r\n *\r\n *\r\n * @link http://www.saxproject.org/apidoc/org/xml/sax/ext/DeclHandler.html\r\n * IGNORED method of org.xml.sax.ext.DeclHandler\r\n * \t#attributeDecl(eName, aName, type, mode, value)\r\n *  #elementDecl(name, model)\r\n *  #externalEntityDecl(name, publicId, systemId)\r\n *  #internalEntityDecl(name, value)\r\n * @link http://www.saxproject.org/apidoc/org/xml/sax/ext/EntityResolver2.html\r\n * IGNORED method of org.xml.sax.EntityResolver2\r\n *  #resolveEntity(String name,String publicId,String baseURI,String systemId)\r\n *  #resolveEntity(publicId, systemId)\r\n *  #getExternalSubset(name, baseURI)\r\n * @link http://www.saxproject.org/apidoc/org/xml/sax/DTDHandler.html\r\n * IGNORED method of org.xml.sax.DTDHandler\r\n *  #notationDecl(name, publicId, systemId) {};\r\n *  #unparsedEntityDecl(name, publicId, systemId, notationName) {};\r\n */\r\n\"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl\".replace(/\\w+/g,function(key){\r\n\tDOMHandler.prototype[key] = function(){return null}\r\n})\r\n\r\n/* Private static helpers treated below as private instance methods, so don't need to add these to the public API; we might use a Relator to also get rid of non-standard public properties */\r\nfunction appendElement (hander,node) {\r\n    if (!hander.currentElement) {\r\n        hander.doc.appendChild(node);\r\n    } else {\r\n        hander.currentElement.appendChild(node);\r\n    }\r\n}//appendChild and setAttributeNS are preformance key\r\n\r\n//if(typeof require == 'function'){\r\n\tvar XMLReader = __webpack_require__(/*! ./sax */ \"./node_modules/xmldom/sax.js\").XMLReader;\r\n\tvar DOMImplementation = exports.DOMImplementation = __webpack_require__(/*! ./dom */ \"./node_modules/xmldom/dom.js\").DOMImplementation;\r\n\texports.XMLSerializer = __webpack_require__(/*! ./dom */ \"./node_modules/xmldom/dom.js\").XMLSerializer ;\r\n\texports.DOMParser = DOMParser;\r\n//}\r\n\n\n//# sourceURL=webpack:///./node_modules/xmldom/dom-parser.js?");

/***/ }),

/***/ "./node_modules/xmldom/dom.js":
/*!************************************!*\
  !*** ./node_modules/xmldom/dom.js ***!
  \************************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("/*\n * DOM Level 2\n * Object DOMException\n * @see http://www.w3.org/TR/REC-DOM-Level-1/ecma-script-language-binding.html\n * @see http://www.w3.org/TR/2000/REC-DOM-Level-2-Core-20001113/ecma-script-binding.html\n */\n\nfunction copy(src,dest){\n\tfor(var p in src){\n\t\tdest[p] = src[p];\n\t}\n}\n/**\n^\\w+\\.prototype\\.([_\\w]+)\\s*=\\s*((?:.*\\{\\s*?[\\r\\n][\\s\\S]*?^})|\\S.*?(?=[;\\r\\n]));?\n^\\w+\\.prototype\\.([_\\w]+)\\s*=\\s*(\\S.*?(?=[;\\r\\n]));?\n */\nfunction _extends(Class,Super){\n\tvar pt = Class.prototype;\n\tif(Object.create){\n\t\tvar ppt = Object.create(Super.prototype)\n\t\tpt.__proto__ = ppt;\n\t}\n\tif(!(pt instanceof Super)){\n\t\tfunction t(){};\n\t\tt.prototype = Super.prototype;\n\t\tt = new t();\n\t\tcopy(pt,t);\n\t\tClass.prototype = pt = t;\n\t}\n\tif(pt.constructor != Class){\n\t\tif(typeof Class != 'function'){\n\t\t\tconsole.error(\"unknow Class:\"+Class)\n\t\t}\n\t\tpt.constructor = Class\n\t}\n}\nvar htmlns = 'http://www.w3.org/1999/xhtml' ;\n// Node Types\nvar NodeType = {}\nvar ELEMENT_NODE                = NodeType.ELEMENT_NODE                = 1;\nvar ATTRIBUTE_NODE              = NodeType.ATTRIBUTE_NODE              = 2;\nvar TEXT_NODE                   = NodeType.TEXT_NODE                   = 3;\nvar CDATA_SECTION_NODE          = NodeType.CDATA_SECTION_NODE          = 4;\nvar ENTITY_REFERENCE_NODE       = NodeType.ENTITY_REFERENCE_NODE       = 5;\nvar ENTITY_NODE                 = NodeType.ENTITY_NODE                 = 6;\nvar PROCESSING_INSTRUCTION_NODE = NodeType.PROCESSING_INSTRUCTION_NODE = 7;\nvar COMMENT_NODE                = NodeType.COMMENT_NODE                = 8;\nvar DOCUMENT_NODE               = NodeType.DOCUMENT_NODE               = 9;\nvar DOCUMENT_TYPE_NODE          = NodeType.DOCUMENT_TYPE_NODE          = 10;\nvar DOCUMENT_FRAGMENT_NODE      = NodeType.DOCUMENT_FRAGMENT_NODE      = 11;\nvar NOTATION_NODE               = NodeType.NOTATION_NODE               = 12;\n\n// ExceptionCode\nvar ExceptionCode = {}\nvar ExceptionMessage = {};\nvar INDEX_SIZE_ERR              = ExceptionCode.INDEX_SIZE_ERR              = ((ExceptionMessage[1]=\"Index size error\"),1);\nvar DOMSTRING_SIZE_ERR          = ExceptionCode.DOMSTRING_SIZE_ERR          = ((ExceptionMessage[2]=\"DOMString size error\"),2);\nvar HIERARCHY_REQUEST_ERR       = ExceptionCode.HIERARCHY_REQUEST_ERR       = ((ExceptionMessage[3]=\"Hierarchy request error\"),3);\nvar WRONG_DOCUMENT_ERR          = ExceptionCode.WRONG_DOCUMENT_ERR          = ((ExceptionMessage[4]=\"Wrong document\"),4);\nvar INVALID_CHARACTER_ERR       = ExceptionCode.INVALID_CHARACTER_ERR       = ((ExceptionMessage[5]=\"Invalid character\"),5);\nvar NO_DATA_ALLOWED_ERR         = ExceptionCode.NO_DATA_ALLOWED_ERR         = ((ExceptionMessage[6]=\"No data allowed\"),6);\nvar NO_MODIFICATION_ALLOWED_ERR = ExceptionCode.NO_MODIFICATION_ALLOWED_ERR = ((ExceptionMessage[7]=\"No modification allowed\"),7);\nvar NOT_FOUND_ERR               = ExceptionCode.NOT_FOUND_ERR               = ((ExceptionMessage[8]=\"Not found\"),8);\nvar NOT_SUPPORTED_ERR           = ExceptionCode.NOT_SUPPORTED_ERR           = ((ExceptionMessage[9]=\"Not supported\"),9);\nvar INUSE_ATTRIBUTE_ERR         = ExceptionCode.INUSE_ATTRIBUTE_ERR         = ((ExceptionMessage[10]=\"Attribute in use\"),10);\n//level2\nvar INVALID_STATE_ERR        \t= ExceptionCode.INVALID_STATE_ERR        \t= ((ExceptionMessage[11]=\"Invalid state\"),11);\nvar SYNTAX_ERR               \t= ExceptionCode.SYNTAX_ERR               \t= ((ExceptionMessage[12]=\"Syntax error\"),12);\nvar INVALID_MODIFICATION_ERR \t= ExceptionCode.INVALID_MODIFICATION_ERR \t= ((ExceptionMessage[13]=\"Invalid modification\"),13);\nvar NAMESPACE_ERR            \t= ExceptionCode.NAMESPACE_ERR           \t= ((ExceptionMessage[14]=\"Invalid namespace\"),14);\nvar INVALID_ACCESS_ERR       \t= ExceptionCode.INVALID_ACCESS_ERR      \t= ((ExceptionMessage[15]=\"Invalid access\"),15);\n\n\nfunction DOMException(code, message) {\n\tif(message instanceof Error){\n\t\tvar error = message;\n\t}else{\n\t\terror = this;\n\t\tError.call(this, ExceptionMessage[code]);\n\t\tthis.message = ExceptionMessage[code];\n\t\tif(Error.captureStackTrace) Error.captureStackTrace(this, DOMException);\n\t}\n\terror.code = code;\n\tif(message) this.message = this.message + \": \" + message;\n\treturn error;\n};\nDOMException.prototype = Error.prototype;\ncopy(ExceptionCode,DOMException)\n/**\n * @see http://www.w3.org/TR/2000/REC-DOM-Level-2-Core-20001113/core.html#ID-536297177\n * The NodeList interface provides the abstraction of an ordered collection of nodes, without defining or constraining how this collection is implemented. NodeList objects in the DOM are live.\n * The items in the NodeList are accessible via an integral index, starting from 0.\n */\nfunction NodeList() {\n};\nNodeList.prototype = {\n\t/**\n\t * The number of nodes in the list. The range of valid child node indices is 0 to length-1 inclusive.\n\t * @standard level1\n\t */\n\tlength:0, \n\t/**\n\t * Returns the indexth item in the collection. If index is greater than or equal to the number of nodes in the list, this returns null.\n\t * @standard level1\n\t * @param index  unsigned long \n\t *   Index into the collection.\n\t * @return Node\n\t * \tThe node at the indexth position in the NodeList, or null if that is not a valid index. \n\t */\n\titem: function(index) {\n\t\treturn this[index] || null;\n\t},\n\ttoString:function(isHTML,nodeFilter){\n\t\tfor(var buf = [], i = 0;i<this.length;i++){\n\t\t\tserializeToString(this[i],buf,isHTML,nodeFilter);\n\t\t}\n\t\treturn buf.join('');\n\t}\n};\nfunction LiveNodeList(node,refresh){\n\tthis._node = node;\n\tthis._refresh = refresh\n\t_updateLiveList(this);\n}\nfunction _updateLiveList(list){\n\tvar inc = list._node._inc || list._node.ownerDocument._inc;\n\tif(list._inc != inc){\n\t\tvar ls = list._refresh(list._node);\n\t\t//console.log(ls.length)\n\t\t__set__(list,'length',ls.length);\n\t\tcopy(ls,list);\n\t\tlist._inc = inc;\n\t}\n}\nLiveNodeList.prototype.item = function(i){\n\t_updateLiveList(this);\n\treturn this[i];\n}\n\n_extends(LiveNodeList,NodeList);\n/**\n * \n * Objects implementing the NamedNodeMap interface are used to represent collections of nodes that can be accessed by name. Note that NamedNodeMap does not inherit from NodeList; NamedNodeMaps are not maintained in any particular order. Objects contained in an object implementing NamedNodeMap may also be accessed by an ordinal index, but this is simply to allow convenient enumeration of the contents of a NamedNodeMap, and does not imply that the DOM specifies an order to these Nodes.\n * NamedNodeMap objects in the DOM are live.\n * used for attributes or DocumentType entities \n */\nfunction NamedNodeMap() {\n};\n\nfunction _findNodeIndex(list,node){\n\tvar i = list.length;\n\twhile(i--){\n\t\tif(list[i] === node){return i}\n\t}\n}\n\nfunction _addNamedNode(el,list,newAttr,oldAttr){\n\tif(oldAttr){\n\t\tlist[_findNodeIndex(list,oldAttr)] = newAttr;\n\t}else{\n\t\tlist[list.length++] = newAttr;\n\t}\n\tif(el){\n\t\tnewAttr.ownerElement = el;\n\t\tvar doc = el.ownerDocument;\n\t\tif(doc){\n\t\t\toldAttr && _onRemoveAttribute(doc,el,oldAttr);\n\t\t\t_onAddAttribute(doc,el,newAttr);\n\t\t}\n\t}\n}\nfunction _removeNamedNode(el,list,attr){\n\t//console.log('remove attr:'+attr)\n\tvar i = _findNodeIndex(list,attr);\n\tif(i>=0){\n\t\tvar lastIndex = list.length-1\n\t\twhile(i<lastIndex){\n\t\t\tlist[i] = list[++i]\n\t\t}\n\t\tlist.length = lastIndex;\n\t\tif(el){\n\t\t\tvar doc = el.ownerDocument;\n\t\t\tif(doc){\n\t\t\t\t_onRemoveAttribute(doc,el,attr);\n\t\t\t\tattr.ownerElement = null;\n\t\t\t}\n\t\t}\n\t}else{\n\t\tthrow DOMException(NOT_FOUND_ERR,new Error(el.tagName+'@'+attr))\n\t}\n}\nNamedNodeMap.prototype = {\n\tlength:0,\n\titem:NodeList.prototype.item,\n\tgetNamedItem: function(key) {\n//\t\tif(key.indexOf(':')>0 || key == 'xmlns'){\n//\t\t\treturn null;\n//\t\t}\n\t\t//console.log()\n\t\tvar i = this.length;\n\t\twhile(i--){\n\t\t\tvar attr = this[i];\n\t\t\t//console.log(attr.nodeName,key)\n\t\t\tif(attr.nodeName == key){\n\t\t\t\treturn attr;\n\t\t\t}\n\t\t}\n\t},\n\tsetNamedItem: function(attr) {\n\t\tvar el = attr.ownerElement;\n\t\tif(el && el!=this._ownerElement){\n\t\t\tthrow new DOMException(INUSE_ATTRIBUTE_ERR);\n\t\t}\n\t\tvar oldAttr = this.getNamedItem(attr.nodeName);\n\t\t_addNamedNode(this._ownerElement,this,attr,oldAttr);\n\t\treturn oldAttr;\n\t},\n\t/* returns Node */\n\tsetNamedItemNS: function(attr) {// raises: WRONG_DOCUMENT_ERR,NO_MODIFICATION_ALLOWED_ERR,INUSE_ATTRIBUTE_ERR\n\t\tvar el = attr.ownerElement, oldAttr;\n\t\tif(el && el!=this._ownerElement){\n\t\t\tthrow new DOMException(INUSE_ATTRIBUTE_ERR);\n\t\t}\n\t\toldAttr = this.getNamedItemNS(attr.namespaceURI,attr.localName);\n\t\t_addNamedNode(this._ownerElement,this,attr,oldAttr);\n\t\treturn oldAttr;\n\t},\n\n\t/* returns Node */\n\tremoveNamedItem: function(key) {\n\t\tvar attr = this.getNamedItem(key);\n\t\t_removeNamedNode(this._ownerElement,this,attr);\n\t\treturn attr;\n\t\t\n\t\t\n\t},// raises: NOT_FOUND_ERR,NO_MODIFICATION_ALLOWED_ERR\n\t\n\t//for level2\n\tremoveNamedItemNS:function(namespaceURI,localName){\n\t\tvar attr = this.getNamedItemNS(namespaceURI,localName);\n\t\t_removeNamedNode(this._ownerElement,this,attr);\n\t\treturn attr;\n\t},\n\tgetNamedItemNS: function(namespaceURI, localName) {\n\t\tvar i = this.length;\n\t\twhile(i--){\n\t\t\tvar node = this[i];\n\t\t\tif(node.localName == localName && node.namespaceURI == namespaceURI){\n\t\t\t\treturn node;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n};\n/**\n * @see http://www.w3.org/TR/REC-DOM-Level-1/level-one-core.html#ID-102161490\n */\nfunction DOMImplementation(/* Object */ features) {\n\tthis._features = {};\n\tif (features) {\n\t\tfor (var feature in features) {\n\t\t\t this._features = features[feature];\n\t\t}\n\t}\n};\n\nDOMImplementation.prototype = {\n\thasFeature: function(/* string */ feature, /* string */ version) {\n\t\tvar versions = this._features[feature.toLowerCase()];\n\t\tif (versions && (!version || version in versions)) {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t},\n\t// Introduced in DOM Level 2:\n\tcreateDocument:function(namespaceURI,  qualifiedName, doctype){// raises:INVALID_CHARACTER_ERR,NAMESPACE_ERR,WRONG_DOCUMENT_ERR\n\t\tvar doc = new Document();\n\t\tdoc.implementation = this;\n\t\tdoc.childNodes = new NodeList();\n\t\tdoc.doctype = doctype;\n\t\tif(doctype){\n\t\t\tdoc.appendChild(doctype);\n\t\t}\n\t\tif(qualifiedName){\n\t\t\tvar root = doc.createElementNS(namespaceURI,qualifiedName);\n\t\t\tdoc.appendChild(root);\n\t\t}\n\t\treturn doc;\n\t},\n\t// Introduced in DOM Level 2:\n\tcreateDocumentType:function(qualifiedName, publicId, systemId){// raises:INVALID_CHARACTER_ERR,NAMESPACE_ERR\n\t\tvar node = new DocumentType();\n\t\tnode.name = qualifiedName;\n\t\tnode.nodeName = qualifiedName;\n\t\tnode.publicId = publicId;\n\t\tnode.systemId = systemId;\n\t\t// Introduced in DOM Level 2:\n\t\t//readonly attribute DOMString        internalSubset;\n\t\t\n\t\t//TODO:..\n\t\t//  readonly attribute NamedNodeMap     entities;\n\t\t//  readonly attribute NamedNodeMap     notations;\n\t\treturn node;\n\t}\n};\n\n\n/**\n * @see http://www.w3.org/TR/2000/REC-DOM-Level-2-Core-20001113/core.html#ID-1950641247\n */\n\nfunction Node() {\n};\n\nNode.prototype = {\n\tfirstChild : null,\n\tlastChild : null,\n\tpreviousSibling : null,\n\tnextSibling : null,\n\tattributes : null,\n\tparentNode : null,\n\tchildNodes : null,\n\townerDocument : null,\n\tnodeValue : null,\n\tnamespaceURI : null,\n\tprefix : null,\n\tlocalName : null,\n\t// Modified in DOM Level 2:\n\tinsertBefore:function(newChild, refChild){//raises \n\t\treturn _insertBefore(this,newChild,refChild);\n\t},\n\treplaceChild:function(newChild, oldChild){//raises \n\t\tthis.insertBefore(newChild,oldChild);\n\t\tif(oldChild){\n\t\t\tthis.removeChild(oldChild);\n\t\t}\n\t},\n\tremoveChild:function(oldChild){\n\t\treturn _removeChild(this,oldChild);\n\t},\n\tappendChild:function(newChild){\n\t\treturn this.insertBefore(newChild,null);\n\t},\n\thasChildNodes:function(){\n\t\treturn this.firstChild != null;\n\t},\n\tcloneNode:function(deep){\n\t\treturn cloneNode(this.ownerDocument||this,this,deep);\n\t},\n\t// Modified in DOM Level 2:\n\tnormalize:function(){\n\t\tvar child = this.firstChild;\n\t\twhile(child){\n\t\t\tvar next = child.nextSibling;\n\t\t\tif(next && next.nodeType == TEXT_NODE && child.nodeType == TEXT_NODE){\n\t\t\t\tthis.removeChild(next);\n\t\t\t\tchild.appendData(next.data);\n\t\t\t}else{\n\t\t\t\tchild.normalize();\n\t\t\t\tchild = next;\n\t\t\t}\n\t\t}\n\t},\n  \t// Introduced in DOM Level 2:\n\tisSupported:function(feature, version){\n\t\treturn this.ownerDocument.implementation.hasFeature(feature,version);\n\t},\n    // Introduced in DOM Level 2:\n    hasAttributes:function(){\n    \treturn this.attributes.length>0;\n    },\n    lookupPrefix:function(namespaceURI){\n    \tvar el = this;\n    \twhile(el){\n    \t\tvar map = el._nsMap;\n    \t\t//console.dir(map)\n    \t\tif(map){\n    \t\t\tfor(var n in map){\n    \t\t\t\tif(map[n] == namespaceURI){\n    \t\t\t\t\treturn n;\n    \t\t\t\t}\n    \t\t\t}\n    \t\t}\n    \t\tel = el.nodeType == ATTRIBUTE_NODE?el.ownerDocument : el.parentNode;\n    \t}\n    \treturn null;\n    },\n    // Introduced in DOM Level 3:\n    lookupNamespaceURI:function(prefix){\n    \tvar el = this;\n    \twhile(el){\n    \t\tvar map = el._nsMap;\n    \t\t//console.dir(map)\n    \t\tif(map){\n    \t\t\tif(prefix in map){\n    \t\t\t\treturn map[prefix] ;\n    \t\t\t}\n    \t\t}\n    \t\tel = el.nodeType == ATTRIBUTE_NODE?el.ownerDocument : el.parentNode;\n    \t}\n    \treturn null;\n    },\n    // Introduced in DOM Level 3:\n    isDefaultNamespace:function(namespaceURI){\n    \tvar prefix = this.lookupPrefix(namespaceURI);\n    \treturn prefix == null;\n    }\n};\n\n\nfunction _xmlEncoder(c){\n\treturn c == '<' && '&lt;' ||\n         c == '>' && '&gt;' ||\n         c == '&' && '&amp;' ||\n         c == '\"' && '&quot;' ||\n         '&#'+c.charCodeAt()+';'\n}\n\n\ncopy(NodeType,Node);\ncopy(NodeType,Node.prototype);\n\n/**\n * @param callback return true for continue,false for break\n * @return boolean true: break visit;\n */\nfunction _visitNode(node,callback){\n\tif(callback(node)){\n\t\treturn true;\n\t}\n\tif(node = node.firstChild){\n\t\tdo{\n\t\t\tif(_visitNode(node,callback)){return true}\n        }while(node=node.nextSibling)\n    }\n}\n\n\n\nfunction Document(){\n}\nfunction _onAddAttribute(doc,el,newAttr){\n\tdoc && doc._inc++;\n\tvar ns = newAttr.namespaceURI ;\n\tif(ns == 'http://www.w3.org/2000/xmlns/'){\n\t\t//update namespace\n\t\tel._nsMap[newAttr.prefix?newAttr.localName:''] = newAttr.value\n\t}\n}\nfunction _onRemoveAttribute(doc,el,newAttr,remove){\n\tdoc && doc._inc++;\n\tvar ns = newAttr.namespaceURI ;\n\tif(ns == 'http://www.w3.org/2000/xmlns/'){\n\t\t//update namespace\n\t\tdelete el._nsMap[newAttr.prefix?newAttr.localName:'']\n\t}\n}\nfunction _onUpdateChild(doc,el,newChild){\n\tif(doc && doc._inc){\n\t\tdoc._inc++;\n\t\t//update childNodes\n\t\tvar cs = el.childNodes;\n\t\tif(newChild){\n\t\t\tcs[cs.length++] = newChild;\n\t\t}else{\n\t\t\t//console.log(1)\n\t\t\tvar child = el.firstChild;\n\t\t\tvar i = 0;\n\t\t\twhile(child){\n\t\t\t\tcs[i++] = child;\n\t\t\t\tchild =child.nextSibling;\n\t\t\t}\n\t\t\tcs.length = i;\n\t\t}\n\t}\n}\n\n/**\n * attributes;\n * children;\n * \n * writeable properties:\n * nodeValue,Attr:value,CharacterData:data\n * prefix\n */\nfunction _removeChild(parentNode,child){\n\tvar previous = child.previousSibling;\n\tvar next = child.nextSibling;\n\tif(previous){\n\t\tprevious.nextSibling = next;\n\t}else{\n\t\tparentNode.firstChild = next\n\t}\n\tif(next){\n\t\tnext.previousSibling = previous;\n\t}else{\n\t\tparentNode.lastChild = previous;\n\t}\n\t_onUpdateChild(parentNode.ownerDocument,parentNode);\n\treturn child;\n}\n/**\n * preformance key(refChild == null)\n */\nfunction _insertBefore(parentNode,newChild,nextChild){\n\tvar cp = newChild.parentNode;\n\tif(cp){\n\t\tcp.removeChild(newChild);//remove and update\n\t}\n\tif(newChild.nodeType === DOCUMENT_FRAGMENT_NODE){\n\t\tvar newFirst = newChild.firstChild;\n\t\tif (newFirst == null) {\n\t\t\treturn newChild;\n\t\t}\n\t\tvar newLast = newChild.lastChild;\n\t}else{\n\t\tnewFirst = newLast = newChild;\n\t}\n\tvar pre = nextChild ? nextChild.previousSibling : parentNode.lastChild;\n\n\tnewFirst.previousSibling = pre;\n\tnewLast.nextSibling = nextChild;\n\t\n\t\n\tif(pre){\n\t\tpre.nextSibling = newFirst;\n\t}else{\n\t\tparentNode.firstChild = newFirst;\n\t}\n\tif(nextChild == null){\n\t\tparentNode.lastChild = newLast;\n\t}else{\n\t\tnextChild.previousSibling = newLast;\n\t}\n\tdo{\n\t\tnewFirst.parentNode = parentNode;\n\t}while(newFirst !== newLast && (newFirst= newFirst.nextSibling))\n\t_onUpdateChild(parentNode.ownerDocument||parentNode,parentNode);\n\t//console.log(parentNode.lastChild.nextSibling == null)\n\tif (newChild.nodeType == DOCUMENT_FRAGMENT_NODE) {\n\t\tnewChild.firstChild = newChild.lastChild = null;\n\t}\n\treturn newChild;\n}\nfunction _appendSingleChild(parentNode,newChild){\n\tvar cp = newChild.parentNode;\n\tif(cp){\n\t\tvar pre = parentNode.lastChild;\n\t\tcp.removeChild(newChild);//remove and update\n\t\tvar pre = parentNode.lastChild;\n\t}\n\tvar pre = parentNode.lastChild;\n\tnewChild.parentNode = parentNode;\n\tnewChild.previousSibling = pre;\n\tnewChild.nextSibling = null;\n\tif(pre){\n\t\tpre.nextSibling = newChild;\n\t}else{\n\t\tparentNode.firstChild = newChild;\n\t}\n\tparentNode.lastChild = newChild;\n\t_onUpdateChild(parentNode.ownerDocument,parentNode,newChild);\n\treturn newChild;\n\t//console.log(\"__aa\",parentNode.lastChild.nextSibling == null)\n}\nDocument.prototype = {\n\t//implementation : null,\n\tnodeName :  '#document',\n\tnodeType :  DOCUMENT_NODE,\n\tdoctype :  null,\n\tdocumentElement :  null,\n\t_inc : 1,\n\t\n\tinsertBefore :  function(newChild, refChild){//raises \n\t\tif(newChild.nodeType == DOCUMENT_FRAGMENT_NODE){\n\t\t\tvar child = newChild.firstChild;\n\t\t\twhile(child){\n\t\t\t\tvar next = child.nextSibling;\n\t\t\t\tthis.insertBefore(child,refChild);\n\t\t\t\tchild = next;\n\t\t\t}\n\t\t\treturn newChild;\n\t\t}\n\t\tif(this.documentElement == null && newChild.nodeType == ELEMENT_NODE){\n\t\t\tthis.documentElement = newChild;\n\t\t}\n\t\t\n\t\treturn _insertBefore(this,newChild,refChild),(newChild.ownerDocument = this),newChild;\n\t},\n\tremoveChild :  function(oldChild){\n\t\tif(this.documentElement == oldChild){\n\t\t\tthis.documentElement = null;\n\t\t}\n\t\treturn _removeChild(this,oldChild);\n\t},\n\t// Introduced in DOM Level 2:\n\timportNode : function(importedNode,deep){\n\t\treturn importNode(this,importedNode,deep);\n\t},\n\t// Introduced in DOM Level 2:\n\tgetElementById :\tfunction(id){\n\t\tvar rtv = null;\n\t\t_visitNode(this.documentElement,function(node){\n\t\t\tif(node.nodeType == ELEMENT_NODE){\n\t\t\t\tif(node.getAttribute('id') == id){\n\t\t\t\t\trtv = node;\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t\treturn rtv;\n\t},\n\t\n\t//document factory method:\n\tcreateElement :\tfunction(tagName){\n\t\tvar node = new Element();\n\t\tnode.ownerDocument = this;\n\t\tnode.nodeName = tagName;\n\t\tnode.tagName = tagName;\n\t\tnode.childNodes = new NodeList();\n\t\tvar attrs\t= node.attributes = new NamedNodeMap();\n\t\tattrs._ownerElement = node;\n\t\treturn node;\n\t},\n\tcreateDocumentFragment :\tfunction(){\n\t\tvar node = new DocumentFragment();\n\t\tnode.ownerDocument = this;\n\t\tnode.childNodes = new NodeList();\n\t\treturn node;\n\t},\n\tcreateTextNode :\tfunction(data){\n\t\tvar node = new Text();\n\t\tnode.ownerDocument = this;\n\t\tnode.appendData(data)\n\t\treturn node;\n\t},\n\tcreateComment :\tfunction(data){\n\t\tvar node = new Comment();\n\t\tnode.ownerDocument = this;\n\t\tnode.appendData(data)\n\t\treturn node;\n\t},\n\tcreateCDATASection :\tfunction(data){\n\t\tvar node = new CDATASection();\n\t\tnode.ownerDocument = this;\n\t\tnode.appendData(data)\n\t\treturn node;\n\t},\n\tcreateProcessingInstruction :\tfunction(target,data){\n\t\tvar node = new ProcessingInstruction();\n\t\tnode.ownerDocument = this;\n\t\tnode.tagName = node.target = target;\n\t\tnode.nodeValue= node.data = data;\n\t\treturn node;\n\t},\n\tcreateAttribute :\tfunction(name){\n\t\tvar node = new Attr();\n\t\tnode.ownerDocument\t= this;\n\t\tnode.name = name;\n\t\tnode.nodeName\t= name;\n\t\tnode.localName = name;\n\t\tnode.specified = true;\n\t\treturn node;\n\t},\n\tcreateEntityReference :\tfunction(name){\n\t\tvar node = new EntityReference();\n\t\tnode.ownerDocument\t= this;\n\t\tnode.nodeName\t= name;\n\t\treturn node;\n\t},\n\t// Introduced in DOM Level 2:\n\tcreateElementNS :\tfunction(namespaceURI,qualifiedName){\n\t\tvar node = new Element();\n\t\tvar pl = qualifiedName.split(':');\n\t\tvar attrs\t= node.attributes = new NamedNodeMap();\n\t\tnode.childNodes = new NodeList();\n\t\tnode.ownerDocument = this;\n\t\tnode.nodeName = qualifiedName;\n\t\tnode.tagName = qualifiedName;\n\t\tnode.namespaceURI = namespaceURI;\n\t\tif(pl.length == 2){\n\t\t\tnode.prefix = pl[0];\n\t\t\tnode.localName = pl[1];\n\t\t}else{\n\t\t\t//el.prefix = null;\n\t\t\tnode.localName = qualifiedName;\n\t\t}\n\t\tattrs._ownerElement = node;\n\t\treturn node;\n\t},\n\t// Introduced in DOM Level 2:\n\tcreateAttributeNS :\tfunction(namespaceURI,qualifiedName){\n\t\tvar node = new Attr();\n\t\tvar pl = qualifiedName.split(':');\n\t\tnode.ownerDocument = this;\n\t\tnode.nodeName = qualifiedName;\n\t\tnode.name = qualifiedName;\n\t\tnode.namespaceURI = namespaceURI;\n\t\tnode.specified = true;\n\t\tif(pl.length == 2){\n\t\t\tnode.prefix = pl[0];\n\t\t\tnode.localName = pl[1];\n\t\t}else{\n\t\t\t//el.prefix = null;\n\t\t\tnode.localName = qualifiedName;\n\t\t}\n\t\treturn node;\n\t}\n};\n_extends(Document,Node);\n\n\nfunction Element() {\n\tthis._nsMap = {};\n};\nElement.prototype = {\n\tnodeType : ELEMENT_NODE,\n\thasAttribute : function(name){\n\t\treturn this.getAttributeNode(name)!=null;\n\t},\n\tgetAttribute : function(name){\n\t\tvar attr = this.getAttributeNode(name);\n\t\treturn attr && attr.value || '';\n\t},\n\tgetAttributeNode : function(name){\n\t\treturn this.attributes.getNamedItem(name);\n\t},\n\tsetAttribute : function(name, value){\n\t\tvar attr = this.ownerDocument.createAttribute(name);\n\t\tattr.value = attr.nodeValue = \"\" + value;\n\t\tthis.setAttributeNode(attr)\n\t},\n\tremoveAttribute : function(name){\n\t\tvar attr = this.getAttributeNode(name)\n\t\tattr && this.removeAttributeNode(attr);\n\t},\n\t\n\t//four real opeartion method\n\tappendChild:function(newChild){\n\t\tif(newChild.nodeType === DOCUMENT_FRAGMENT_NODE){\n\t\t\treturn this.insertBefore(newChild,null);\n\t\t}else{\n\t\t\treturn _appendSingleChild(this,newChild);\n\t\t}\n\t},\n\tsetAttributeNode : function(newAttr){\n\t\treturn this.attributes.setNamedItem(newAttr);\n\t},\n\tsetAttributeNodeNS : function(newAttr){\n\t\treturn this.attributes.setNamedItemNS(newAttr);\n\t},\n\tremoveAttributeNode : function(oldAttr){\n\t\t//console.log(this == oldAttr.ownerElement)\n\t\treturn this.attributes.removeNamedItem(oldAttr.nodeName);\n\t},\n\t//get real attribute name,and remove it by removeAttributeNode\n\tremoveAttributeNS : function(namespaceURI, localName){\n\t\tvar old = this.getAttributeNodeNS(namespaceURI, localName);\n\t\told && this.removeAttributeNode(old);\n\t},\n\t\n\thasAttributeNS : function(namespaceURI, localName){\n\t\treturn this.getAttributeNodeNS(namespaceURI, localName)!=null;\n\t},\n\tgetAttributeNS : function(namespaceURI, localName){\n\t\tvar attr = this.getAttributeNodeNS(namespaceURI, localName);\n\t\treturn attr && attr.value || '';\n\t},\n\tsetAttributeNS : function(namespaceURI, qualifiedName, value){\n\t\tvar attr = this.ownerDocument.createAttributeNS(namespaceURI, qualifiedName);\n\t\tattr.value = attr.nodeValue = \"\" + value;\n\t\tthis.setAttributeNode(attr)\n\t},\n\tgetAttributeNodeNS : function(namespaceURI, localName){\n\t\treturn this.attributes.getNamedItemNS(namespaceURI, localName);\n\t},\n\t\n\tgetElementsByTagName : function(tagName){\n\t\treturn new LiveNodeList(this,function(base){\n\t\t\tvar ls = [];\n\t\t\t_visitNode(base,function(node){\n\t\t\t\tif(node !== base && node.nodeType == ELEMENT_NODE && (tagName === '*' || node.tagName == tagName)){\n\t\t\t\t\tls.push(node);\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn ls;\n\t\t});\n\t},\n\tgetElementsByTagNameNS : function(namespaceURI, localName){\n\t\treturn new LiveNodeList(this,function(base){\n\t\t\tvar ls = [];\n\t\t\t_visitNode(base,function(node){\n\t\t\t\tif(node !== base && node.nodeType === ELEMENT_NODE && (namespaceURI === '*' || node.namespaceURI === namespaceURI) && (localName === '*' || node.localName == localName)){\n\t\t\t\t\tls.push(node);\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn ls;\n\t\t\t\n\t\t});\n\t}\n};\nDocument.prototype.getElementsByTagName = Element.prototype.getElementsByTagName;\nDocument.prototype.getElementsByTagNameNS = Element.prototype.getElementsByTagNameNS;\n\n\n_extends(Element,Node);\nfunction Attr() {\n};\nAttr.prototype.nodeType = ATTRIBUTE_NODE;\n_extends(Attr,Node);\n\n\nfunction CharacterData() {\n};\nCharacterData.prototype = {\n\tdata : '',\n\tsubstringData : function(offset, count) {\n\t\treturn this.data.substring(offset, offset+count);\n\t},\n\tappendData: function(text) {\n\t\ttext = this.data+text;\n\t\tthis.nodeValue = this.data = text;\n\t\tthis.length = text.length;\n\t},\n\tinsertData: function(offset,text) {\n\t\tthis.replaceData(offset,0,text);\n\t\n\t},\n\tappendChild:function(newChild){\n\t\tthrow new Error(ExceptionMessage[HIERARCHY_REQUEST_ERR])\n\t},\n\tdeleteData: function(offset, count) {\n\t\tthis.replaceData(offset,count,\"\");\n\t},\n\treplaceData: function(offset, count, text) {\n\t\tvar start = this.data.substring(0,offset);\n\t\tvar end = this.data.substring(offset+count);\n\t\ttext = start + text + end;\n\t\tthis.nodeValue = this.data = text;\n\t\tthis.length = text.length;\n\t}\n}\n_extends(CharacterData,Node);\nfunction Text() {\n};\nText.prototype = {\n\tnodeName : \"#text\",\n\tnodeType : TEXT_NODE,\n\tsplitText : function(offset) {\n\t\tvar text = this.data;\n\t\tvar newText = text.substring(offset);\n\t\ttext = text.substring(0, offset);\n\t\tthis.data = this.nodeValue = text;\n\t\tthis.length = text.length;\n\t\tvar newNode = this.ownerDocument.createTextNode(newText);\n\t\tif(this.parentNode){\n\t\t\tthis.parentNode.insertBefore(newNode, this.nextSibling);\n\t\t}\n\t\treturn newNode;\n\t}\n}\n_extends(Text,CharacterData);\nfunction Comment() {\n};\nComment.prototype = {\n\tnodeName : \"#comment\",\n\tnodeType : COMMENT_NODE\n}\n_extends(Comment,CharacterData);\n\nfunction CDATASection() {\n};\nCDATASection.prototype = {\n\tnodeName : \"#cdata-section\",\n\tnodeType : CDATA_SECTION_NODE\n}\n_extends(CDATASection,CharacterData);\n\n\nfunction DocumentType() {\n};\nDocumentType.prototype.nodeType = DOCUMENT_TYPE_NODE;\n_extends(DocumentType,Node);\n\nfunction Notation() {\n};\nNotation.prototype.nodeType = NOTATION_NODE;\n_extends(Notation,Node);\n\nfunction Entity() {\n};\nEntity.prototype.nodeType = ENTITY_NODE;\n_extends(Entity,Node);\n\nfunction EntityReference() {\n};\nEntityReference.prototype.nodeType = ENTITY_REFERENCE_NODE;\n_extends(EntityReference,Node);\n\nfunction DocumentFragment() {\n};\nDocumentFragment.prototype.nodeName =\t\"#document-fragment\";\nDocumentFragment.prototype.nodeType =\tDOCUMENT_FRAGMENT_NODE;\n_extends(DocumentFragment,Node);\n\n\nfunction ProcessingInstruction() {\n}\nProcessingInstruction.prototype.nodeType = PROCESSING_INSTRUCTION_NODE;\n_extends(ProcessingInstruction,Node);\nfunction XMLSerializer(){}\nXMLSerializer.prototype.serializeToString = function(node,isHtml,nodeFilter){\n\treturn nodeSerializeToString.call(node,isHtml,nodeFilter);\n}\nNode.prototype.toString = nodeSerializeToString;\nfunction nodeSerializeToString(isHtml,nodeFilter){\n\tvar buf = [];\n\tvar refNode = this.nodeType == 9?this.documentElement:this;\n\tvar prefix = refNode.prefix;\n\tvar uri = refNode.namespaceURI;\n\t\n\tif(uri && prefix == null){\n\t\t//console.log(prefix)\n\t\tvar prefix = refNode.lookupPrefix(uri);\n\t\tif(prefix == null){\n\t\t\t//isHTML = true;\n\t\t\tvar visibleNamespaces=[\n\t\t\t{namespace:uri,prefix:null}\n\t\t\t//{namespace:uri,prefix:''}\n\t\t\t]\n\t\t}\n\t}\n\tserializeToString(this,buf,isHtml,nodeFilter,visibleNamespaces);\n\t//console.log('###',this.nodeType,uri,prefix,buf.join(''))\n\treturn buf.join('');\n}\nfunction needNamespaceDefine(node,isHTML, visibleNamespaces) {\n\tvar prefix = node.prefix||'';\n\tvar uri = node.namespaceURI;\n\tif (!prefix && !uri){\n\t\treturn false;\n\t}\n\tif (prefix === \"xml\" && uri === \"http://www.w3.org/XML/1998/namespace\" \n\t\t|| uri == 'http://www.w3.org/2000/xmlns/'){\n\t\treturn false;\n\t}\n\t\n\tvar i = visibleNamespaces.length \n\t//console.log('@@@@',node.tagName,prefix,uri,visibleNamespaces)\n\twhile (i--) {\n\t\tvar ns = visibleNamespaces[i];\n\t\t// get namespace prefix\n\t\t//console.log(node.nodeType,node.tagName,ns.prefix,prefix)\n\t\tif (ns.prefix == prefix){\n\t\t\treturn ns.namespace != uri;\n\t\t}\n\t}\n\t//console.log(isHTML,uri,prefix=='')\n\t//if(isHTML && prefix ==null && uri == 'http://www.w3.org/1999/xhtml'){\n\t//\treturn false;\n\t//}\n\t//node.flag = '11111'\n\t//console.error(3,true,node.flag,node.prefix,node.namespaceURI)\n\treturn true;\n}\nfunction serializeToString(node,buf,isHTML,nodeFilter,visibleNamespaces){\n\tif(nodeFilter){\n\t\tnode = nodeFilter(node);\n\t\tif(node){\n\t\t\tif(typeof node == 'string'){\n\t\t\t\tbuf.push(node);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}else{\n\t\t\treturn;\n\t\t}\n\t\t//buf.sort.apply(attrs, attributeSorter);\n\t}\n\tswitch(node.nodeType){\n\tcase ELEMENT_NODE:\n\t\tif (!visibleNamespaces) visibleNamespaces = [];\n\t\tvar startVisibleNamespaces = visibleNamespaces.length;\n\t\tvar attrs = node.attributes;\n\t\tvar len = attrs.length;\n\t\tvar child = node.firstChild;\n\t\tvar nodeName = node.tagName;\n\t\t\n\t\tisHTML =  (htmlns === node.namespaceURI) ||isHTML \n\t\tbuf.push('<',nodeName);\n\t\t\n\t\t\n\t\t\n\t\tfor(var i=0;i<len;i++){\n\t\t\t// add namespaces for attributes\n\t\t\tvar attr = attrs.item(i);\n\t\t\tif (attr.prefix == 'xmlns') {\n\t\t\t\tvisibleNamespaces.push({ prefix: attr.localName, namespace: attr.value });\n\t\t\t}else if(attr.nodeName == 'xmlns'){\n\t\t\t\tvisibleNamespaces.push({ prefix: '', namespace: attr.value });\n\t\t\t}\n\t\t}\n\t\tfor(var i=0;i<len;i++){\n\t\t\tvar attr = attrs.item(i);\n\t\t\tif (needNamespaceDefine(attr,isHTML, visibleNamespaces)) {\n\t\t\t\tvar prefix = attr.prefix||'';\n\t\t\t\tvar uri = attr.namespaceURI;\n\t\t\t\tvar ns = prefix ? ' xmlns:' + prefix : \" xmlns\";\n\t\t\t\tbuf.push(ns, '=\"' , uri , '\"');\n\t\t\t\tvisibleNamespaces.push({ prefix: prefix, namespace:uri });\n\t\t\t}\n\t\t\tserializeToString(attr,buf,isHTML,nodeFilter,visibleNamespaces);\n\t\t}\n\t\t// add namespace for current node\t\t\n\t\tif (needNamespaceDefine(node,isHTML, visibleNamespaces)) {\n\t\t\tvar prefix = node.prefix||'';\n\t\t\tvar uri = node.namespaceURI;\n\t\t\tvar ns = prefix ? ' xmlns:' + prefix : \" xmlns\";\n\t\t\tbuf.push(ns, '=\"' , uri , '\"');\n\t\t\tvisibleNamespaces.push({ prefix: prefix, namespace:uri });\n\t\t}\n\t\t\n\t\tif(child || isHTML && !/^(?:meta|link|img|br|hr|input)$/i.test(nodeName)){\n\t\t\tbuf.push('>');\n\t\t\t//if is cdata child node\n\t\t\tif(isHTML && /^script$/i.test(nodeName)){\n\t\t\t\twhile(child){\n\t\t\t\t\tif(child.data){\n\t\t\t\t\t\tbuf.push(child.data);\n\t\t\t\t\t}else{\n\t\t\t\t\t\tserializeToString(child,buf,isHTML,nodeFilter,visibleNamespaces);\n\t\t\t\t\t}\n\t\t\t\t\tchild = child.nextSibling;\n\t\t\t\t}\n\t\t\t}else\n\t\t\t{\n\t\t\t\twhile(child){\n\t\t\t\t\tserializeToString(child,buf,isHTML,nodeFilter,visibleNamespaces);\n\t\t\t\t\tchild = child.nextSibling;\n\t\t\t\t}\n\t\t\t}\n\t\t\tbuf.push('</',nodeName,'>');\n\t\t}else{\n\t\t\tbuf.push('/>');\n\t\t}\n\t\t// remove added visible namespaces\n\t\t//visibleNamespaces.length = startVisibleNamespaces;\n\t\treturn;\n\tcase DOCUMENT_NODE:\n\tcase DOCUMENT_FRAGMENT_NODE:\n\t\tvar child = node.firstChild;\n\t\twhile(child){\n\t\t\tserializeToString(child,buf,isHTML,nodeFilter,visibleNamespaces);\n\t\t\tchild = child.nextSibling;\n\t\t}\n\t\treturn;\n\tcase ATTRIBUTE_NODE:\n\t\treturn buf.push(' ',node.name,'=\"',node.value.replace(/[<&\"]/g,_xmlEncoder),'\"');\n\tcase TEXT_NODE:\n\t\treturn buf.push(node.data.replace(/[<&]/g,_xmlEncoder));\n\tcase CDATA_SECTION_NODE:\n\t\treturn buf.push( '<![CDATA[',node.data,']]>');\n\tcase COMMENT_NODE:\n\t\treturn buf.push( \"<!--\",node.data,\"-->\");\n\tcase DOCUMENT_TYPE_NODE:\n\t\tvar pubid = node.publicId;\n\t\tvar sysid = node.systemId;\n\t\tbuf.push('<!DOCTYPE ',node.name);\n\t\tif(pubid){\n\t\t\tbuf.push(' PUBLIC \"',pubid);\n\t\t\tif (sysid && sysid!='.') {\n\t\t\t\tbuf.push( '\" \"',sysid);\n\t\t\t}\n\t\t\tbuf.push('\">');\n\t\t}else if(sysid && sysid!='.'){\n\t\t\tbuf.push(' SYSTEM \"',sysid,'\">');\n\t\t}else{\n\t\t\tvar sub = node.internalSubset;\n\t\t\tif(sub){\n\t\t\t\tbuf.push(\" [\",sub,\"]\");\n\t\t\t}\n\t\t\tbuf.push(\">\");\n\t\t}\n\t\treturn;\n\tcase PROCESSING_INSTRUCTION_NODE:\n\t\treturn buf.push( \"<?\",node.target,\" \",node.data,\"?>\");\n\tcase ENTITY_REFERENCE_NODE:\n\t\treturn buf.push( '&',node.nodeName,';');\n\t//case ENTITY_NODE:\n\t//case NOTATION_NODE:\n\tdefault:\n\t\tbuf.push('??',node.nodeName);\n\t}\n}\nfunction importNode(doc,node,deep){\n\tvar node2;\n\tswitch (node.nodeType) {\n\tcase ELEMENT_NODE:\n\t\tnode2 = node.cloneNode(false);\n\t\tnode2.ownerDocument = doc;\n\t\t//var attrs = node2.attributes;\n\t\t//var len = attrs.length;\n\t\t//for(var i=0;i<len;i++){\n\t\t\t//node2.setAttributeNodeNS(importNode(doc,attrs.item(i),deep));\n\t\t//}\n\tcase DOCUMENT_FRAGMENT_NODE:\n\t\tbreak;\n\tcase ATTRIBUTE_NODE:\n\t\tdeep = true;\n\t\tbreak;\n\t//case ENTITY_REFERENCE_NODE:\n\t//case PROCESSING_INSTRUCTION_NODE:\n\t////case TEXT_NODE:\n\t//case CDATA_SECTION_NODE:\n\t//case COMMENT_NODE:\n\t//\tdeep = false;\n\t//\tbreak;\n\t//case DOCUMENT_NODE:\n\t//case DOCUMENT_TYPE_NODE:\n\t//cannot be imported.\n\t//case ENTITY_NODE:\n\t//case NOTATION_NODE：\n\t//can not hit in level3\n\t//default:throw e;\n\t}\n\tif(!node2){\n\t\tnode2 = node.cloneNode(false);//false\n\t}\n\tnode2.ownerDocument = doc;\n\tnode2.parentNode = null;\n\tif(deep){\n\t\tvar child = node.firstChild;\n\t\twhile(child){\n\t\t\tnode2.appendChild(importNode(doc,child,deep));\n\t\t\tchild = child.nextSibling;\n\t\t}\n\t}\n\treturn node2;\n}\n//\n//var _relationMap = {firstChild:1,lastChild:1,previousSibling:1,nextSibling:1,\n//\t\t\t\t\tattributes:1,childNodes:1,parentNode:1,documentElement:1,doctype,};\nfunction cloneNode(doc,node,deep){\n\tvar node2 = new node.constructor();\n\tfor(var n in node){\n\t\tvar v = node[n];\n\t\tif(typeof v != 'object' ){\n\t\t\tif(v != node2[n]){\n\t\t\t\tnode2[n] = v;\n\t\t\t}\n\t\t}\n\t}\n\tif(node.childNodes){\n\t\tnode2.childNodes = new NodeList();\n\t}\n\tnode2.ownerDocument = doc;\n\tswitch (node2.nodeType) {\n\tcase ELEMENT_NODE:\n\t\tvar attrs\t= node.attributes;\n\t\tvar attrs2\t= node2.attributes = new NamedNodeMap();\n\t\tvar len = attrs.length\n\t\tattrs2._ownerElement = node2;\n\t\tfor(var i=0;i<len;i++){\n\t\t\tnode2.setAttributeNode(cloneNode(doc,attrs.item(i),true));\n\t\t}\n\t\tbreak;;\n\tcase ATTRIBUTE_NODE:\n\t\tdeep = true;\n\t}\n\tif(deep){\n\t\tvar child = node.firstChild;\n\t\twhile(child){\n\t\t\tnode2.appendChild(cloneNode(doc,child,deep));\n\t\t\tchild = child.nextSibling;\n\t\t}\n\t}\n\treturn node2;\n}\n\nfunction __set__(object,key,value){\n\tobject[key] = value\n}\n//do dynamic\ntry{\n\tif(Object.defineProperty){\n\t\tObject.defineProperty(LiveNodeList.prototype,'length',{\n\t\t\tget:function(){\n\t\t\t\t_updateLiveList(this);\n\t\t\t\treturn this.$$length;\n\t\t\t}\n\t\t});\n\t\tObject.defineProperty(Node.prototype,'textContent',{\n\t\t\tget:function(){\n\t\t\t\treturn getTextContent(this);\n\t\t\t},\n\t\t\tset:function(data){\n\t\t\t\tswitch(this.nodeType){\n\t\t\t\tcase ELEMENT_NODE:\n\t\t\t\tcase DOCUMENT_FRAGMENT_NODE:\n\t\t\t\t\twhile(this.firstChild){\n\t\t\t\t\t\tthis.removeChild(this.firstChild);\n\t\t\t\t\t}\n\t\t\t\t\tif(data || String(data)){\n\t\t\t\t\t\tthis.appendChild(this.ownerDocument.createTextNode(data));\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\t//TODO:\n\t\t\t\t\tthis.data = data;\n\t\t\t\t\tthis.value = data;\n\t\t\t\t\tthis.nodeValue = data;\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t\t\n\t\tfunction getTextContent(node){\n\t\t\tswitch(node.nodeType){\n\t\t\tcase ELEMENT_NODE:\n\t\t\tcase DOCUMENT_FRAGMENT_NODE:\n\t\t\t\tvar buf = [];\n\t\t\t\tnode = node.firstChild;\n\t\t\t\twhile(node){\n\t\t\t\t\tif(node.nodeType!==7 && node.nodeType !==8){\n\t\t\t\t\t\tbuf.push(getTextContent(node));\n\t\t\t\t\t}\n\t\t\t\t\tnode = node.nextSibling;\n\t\t\t\t}\n\t\t\t\treturn buf.join('');\n\t\t\tdefault:\n\t\t\t\treturn node.nodeValue;\n\t\t\t}\n\t\t}\n\t\t__set__ = function(object,key,value){\n\t\t\t//console.log(value)\n\t\t\tobject['$$'+key] = value\n\t\t}\n\t}\n}catch(e){//ie8\n}\n\n//if(typeof require == 'function'){\n\texports.DOMImplementation = DOMImplementation;\n\texports.XMLSerializer = XMLSerializer;\n//}\n\n\n//# sourceURL=webpack:///./node_modules/xmldom/dom.js?");

/***/ }),

/***/ "./node_modules/xmldom/sax.js":
/*!************************************!*\
  !*** ./node_modules/xmldom/sax.js ***!
  \************************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("//[4]   \tNameStartChar\t   ::=   \t\":\" | [A-Z] | \"_\" | [a-z] | [#xC0-#xD6] | [#xD8-#xF6] | [#xF8-#x2FF] | [#x370-#x37D] | [#x37F-#x1FFF] | [#x200C-#x200D] | [#x2070-#x218F] | [#x2C00-#x2FEF] | [#x3001-#xD7FF] | [#xF900-#xFDCF] | [#xFDF0-#xFFFD] | [#x10000-#xEFFFF]\r\n//[4a]   \tNameChar\t   ::=   \tNameStartChar | \"-\" | \".\" | [0-9] | #xB7 | [#x0300-#x036F] | [#x203F-#x2040]\r\n//[5]   \tName\t   ::=   \tNameStartChar (NameChar)*\r\nvar nameStartChar = /[A-Z_a-z\\xC0-\\xD6\\xD8-\\xF6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD]///\\u10000-\\uEFFFF\r\nvar nameChar = new RegExp(\"[\\\\-\\\\.0-9\"+nameStartChar.source.slice(1,-1)+\"\\\\u00B7\\\\u0300-\\\\u036F\\\\u203F-\\\\u2040]\");\r\nvar tagNamePattern = new RegExp('^'+nameStartChar.source+nameChar.source+'*(?:\\:'+nameStartChar.source+nameChar.source+'*)?$');\r\n//var tagNamePattern = /^[a-zA-Z_][\\w\\-\\.]*(?:\\:[a-zA-Z_][\\w\\-\\.]*)?$/\r\n//var handlers = 'resolveEntity,getExternalSubset,characters,endDocument,endElement,endPrefixMapping,ignorableWhitespace,processingInstruction,setDocumentLocator,skippedEntity,startDocument,startElement,startPrefixMapping,notationDecl,unparsedEntityDecl,error,fatalError,warning,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,comment,endCDATA,endDTD,endEntity,startCDATA,startDTD,startEntity'.split(',')\r\n\r\n//S_TAG,\tS_ATTR,\tS_EQ,\tS_ATTR_NOQUOT_VALUE\r\n//S_ATTR_SPACE,\tS_ATTR_END,\tS_TAG_SPACE, S_TAG_CLOSE\r\nvar S_TAG = 0;//tag name offerring\r\nvar S_ATTR = 1;//attr name offerring \r\nvar S_ATTR_SPACE=2;//attr name end and space offer\r\nvar S_EQ = 3;//=space?\r\nvar S_ATTR_NOQUOT_VALUE = 4;//attr value(no quot value only)\r\nvar S_ATTR_END = 5;//attr value end and no space(quot end)\r\nvar S_TAG_SPACE = 6;//(attr value end || tag end ) && (space offer)\r\nvar S_TAG_CLOSE = 7;//closed el<el />\r\n\r\nfunction XMLReader(){\r\n\t\r\n}\r\n\r\nXMLReader.prototype = {\r\n\tparse:function(source,defaultNSMap,entityMap){\r\n\t\tvar domBuilder = this.domBuilder;\r\n\t\tdomBuilder.startDocument();\r\n\t\t_copy(defaultNSMap ,defaultNSMap = {})\r\n\t\tparse(source,defaultNSMap,entityMap,\r\n\t\t\t\tdomBuilder,this.errorHandler);\r\n\t\tdomBuilder.endDocument();\r\n\t}\r\n}\r\nfunction parse(source,defaultNSMapCopy,entityMap,domBuilder,errorHandler){\r\n\tfunction fixedFromCharCode(code) {\r\n\t\t// String.prototype.fromCharCode does not supports\r\n\t\t// > 2 bytes unicode chars directly\r\n\t\tif (code > 0xffff) {\r\n\t\t\tcode -= 0x10000;\r\n\t\t\tvar surrogate1 = 0xd800 + (code >> 10)\r\n\t\t\t\t, surrogate2 = 0xdc00 + (code & 0x3ff);\r\n\r\n\t\t\treturn String.fromCharCode(surrogate1, surrogate2);\r\n\t\t} else {\r\n\t\t\treturn String.fromCharCode(code);\r\n\t\t}\r\n\t}\r\n\tfunction entityReplacer(a){\r\n\t\tvar k = a.slice(1,-1);\r\n\t\tif(k in entityMap){\r\n\t\t\treturn entityMap[k]; \r\n\t\t}else if(k.charAt(0) === '#'){\r\n\t\t\treturn fixedFromCharCode(parseInt(k.substr(1).replace('x','0x')))\r\n\t\t}else{\r\n\t\t\terrorHandler.error('entity not found:'+a);\r\n\t\t\treturn a;\r\n\t\t}\r\n\t}\r\n\tfunction appendText(end){//has some bugs\r\n\t\tif(end>start){\r\n\t\t\tvar xt = source.substring(start,end).replace(/&#?\\w+;/g,entityReplacer);\r\n\t\t\tlocator&&position(start);\r\n\t\t\tdomBuilder.characters(xt,0,end-start);\r\n\t\t\tstart = end\r\n\t\t}\r\n\t}\r\n\tfunction position(p,m){\r\n\t\twhile(p>=lineEnd && (m = linePattern.exec(source))){\r\n\t\t\tlineStart = m.index;\r\n\t\t\tlineEnd = lineStart + m[0].length;\r\n\t\t\tlocator.lineNumber++;\r\n\t\t\t//console.log('line++:',locator,startPos,endPos)\r\n\t\t}\r\n\t\tlocator.columnNumber = p-lineStart+1;\r\n\t}\r\n\tvar lineStart = 0;\r\n\tvar lineEnd = 0;\r\n\tvar linePattern = /.*(?:\\r\\n?|\\n)|.*$/g\r\n\tvar locator = domBuilder.locator;\r\n\t\r\n\tvar parseStack = [{currentNSMap:defaultNSMapCopy}]\r\n\tvar closeMap = {};\r\n\tvar start = 0;\r\n\twhile(true){\r\n\t\ttry{\r\n\t\t\tvar tagStart = source.indexOf('<',start);\r\n\t\t\tif(tagStart<0){\r\n\t\t\t\tif(!source.substr(start).match(/^\\s*$/)){\r\n\t\t\t\t\tvar doc = domBuilder.doc;\r\n\t    \t\t\tvar text = doc.createTextNode(source.substr(start));\r\n\t    \t\t\tdoc.appendChild(text);\r\n\t    \t\t\tdomBuilder.currentElement = text;\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif(tagStart>start){\r\n\t\t\t\tappendText(tagStart);\r\n\t\t\t}\r\n\t\t\tswitch(source.charAt(tagStart+1)){\r\n\t\t\tcase '/':\r\n\t\t\t\tvar end = source.indexOf('>',tagStart+3);\r\n\t\t\t\tvar tagName = source.substring(tagStart+2,end);\r\n\t\t\t\tvar config = parseStack.pop();\r\n\t\t\t\tif(end<0){\r\n\t\t\t\t\t\r\n\t        \t\ttagName = source.substring(tagStart+2).replace(/[\\s<].*/,'');\r\n\t        \t\t//console.error('#@@@@@@'+tagName)\r\n\t        \t\terrorHandler.error(\"end tag name: \"+tagName+' is not complete:'+config.tagName);\r\n\t        \t\tend = tagStart+1+tagName.length;\r\n\t        \t}else if(tagName.match(/\\s</)){\r\n\t        \t\ttagName = tagName.replace(/[\\s<].*/,'');\r\n\t        \t\terrorHandler.error(\"end tag name: \"+tagName+' maybe not complete');\r\n\t        \t\tend = tagStart+1+tagName.length;\r\n\t\t\t\t}\r\n\t\t\t\t//console.error(parseStack.length,parseStack)\r\n\t\t\t\t//console.error(config);\r\n\t\t\t\tvar localNSMap = config.localNSMap;\r\n\t\t\t\tvar endMatch = config.tagName == tagName;\r\n\t\t\t\tvar endIgnoreCaseMach = endMatch || config.tagName&&config.tagName.toLowerCase() == tagName.toLowerCase()\r\n\t\t        if(endIgnoreCaseMach){\r\n\t\t        \tdomBuilder.endElement(config.uri,config.localName,tagName);\r\n\t\t\t\t\tif(localNSMap){\r\n\t\t\t\t\t\tfor(var prefix in localNSMap){\r\n\t\t\t\t\t\t\tdomBuilder.endPrefixMapping(prefix) ;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(!endMatch){\r\n\t\t            \terrorHandler.fatalError(\"end tag name: \"+tagName+' is not match the current start tagName:'+config.tagName );\r\n\t\t\t\t\t}\r\n\t\t        }else{\r\n\t\t        \tparseStack.push(config)\r\n\t\t        }\r\n\t\t\t\t\r\n\t\t\t\tend++;\r\n\t\t\t\tbreak;\r\n\t\t\t\t// end elment\r\n\t\t\tcase '?':// <?...?>\r\n\t\t\t\tlocator&&position(tagStart);\r\n\t\t\t\tend = parseInstruction(source,tagStart,domBuilder);\r\n\t\t\t\tbreak;\r\n\t\t\tcase '!':// <!doctype,<![CDATA,<!--\r\n\t\t\t\tlocator&&position(tagStart);\r\n\t\t\t\tend = parseDCC(source,tagStart,domBuilder,errorHandler);\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tlocator&&position(tagStart);\r\n\t\t\t\tvar el = new ElementAttributes();\r\n\t\t\t\tvar currentNSMap = parseStack[parseStack.length-1].currentNSMap;\r\n\t\t\t\t//elStartEnd\r\n\t\t\t\tvar end = parseElementStartPart(source,tagStart,el,currentNSMap,entityReplacer,errorHandler);\r\n\t\t\t\tvar len = el.length;\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\tif(!el.closed && fixSelfClosed(source,end,el.tagName,closeMap)){\r\n\t\t\t\t\tel.closed = true;\r\n\t\t\t\t\tif(!entityMap.nbsp){\r\n\t\t\t\t\t\terrorHandler.warning('unclosed xml attribute');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif(locator && len){\r\n\t\t\t\t\tvar locator2 = copyLocator(locator,{});\r\n\t\t\t\t\t//try{//attribute position fixed\r\n\t\t\t\t\tfor(var i = 0;i<len;i++){\r\n\t\t\t\t\t\tvar a = el[i];\r\n\t\t\t\t\t\tposition(a.offset);\r\n\t\t\t\t\t\ta.locator = copyLocator(locator,{});\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//}catch(e){console.error('@@@@@'+e)}\r\n\t\t\t\t\tdomBuilder.locator = locator2\r\n\t\t\t\t\tif(appendElement(el,domBuilder,currentNSMap)){\r\n\t\t\t\t\t\tparseStack.push(el)\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdomBuilder.locator = locator;\r\n\t\t\t\t}else{\r\n\t\t\t\t\tif(appendElement(el,domBuilder,currentNSMap)){\r\n\t\t\t\t\t\tparseStack.push(el)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\tif(el.uri === 'http://www.w3.org/1999/xhtml' && !el.closed){\r\n\t\t\t\t\tend = parseHtmlSpecialContent(source,end,el.tagName,entityReplacer,domBuilder)\r\n\t\t\t\t}else{\r\n\t\t\t\t\tend++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}catch(e){\r\n\t\t\terrorHandler.error('element parse error: '+e)\r\n\t\t\t//errorHandler.error('element parse error: '+e);\r\n\t\t\tend = -1;\r\n\t\t\t//throw e;\r\n\t\t}\r\n\t\tif(end>start){\r\n\t\t\tstart = end;\r\n\t\t}else{\r\n\t\t\t//TODO: 这里有可能sax回退，有位置错误风险\r\n\t\t\tappendText(Math.max(tagStart,start)+1);\r\n\t\t}\r\n\t}\r\n}\r\nfunction copyLocator(f,t){\r\n\tt.lineNumber = f.lineNumber;\r\n\tt.columnNumber = f.columnNumber;\r\n\treturn t;\r\n}\r\n\r\n/**\r\n * @see #appendElement(source,elStartEnd,el,selfClosed,entityReplacer,domBuilder,parseStack);\r\n * @return end of the elementStartPart(end of elementEndPart for selfClosed el)\r\n */\r\nfunction parseElementStartPart(source,start,el,currentNSMap,entityReplacer,errorHandler){\r\n\tvar attrName;\r\n\tvar value;\r\n\tvar p = ++start;\r\n\tvar s = S_TAG;//status\r\n\twhile(true){\r\n\t\tvar c = source.charAt(p);\r\n\t\tswitch(c){\r\n\t\tcase '=':\r\n\t\t\tif(s === S_ATTR){//attrName\r\n\t\t\t\tattrName = source.slice(start,p);\r\n\t\t\t\ts = S_EQ;\r\n\t\t\t}else if(s === S_ATTR_SPACE){\r\n\t\t\t\ts = S_EQ;\r\n\t\t\t}else{\r\n\t\t\t\t//fatalError: equal must after attrName or space after attrName\r\n\t\t\t\tthrow new Error('attribute equal must after attrName');\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\tcase '\\'':\r\n\t\tcase '\"':\r\n\t\t\tif(s === S_EQ || s === S_ATTR //|| s == S_ATTR_SPACE\r\n\t\t\t\t){//equal\r\n\t\t\t\tif(s === S_ATTR){\r\n\t\t\t\t\terrorHandler.warning('attribute value must after \"=\"')\r\n\t\t\t\t\tattrName = source.slice(start,p)\r\n\t\t\t\t}\r\n\t\t\t\tstart = p+1;\r\n\t\t\t\tp = source.indexOf(c,start)\r\n\t\t\t\tif(p>0){\r\n\t\t\t\t\tvalue = source.slice(start,p).replace(/&#?\\w+;/g,entityReplacer);\r\n\t\t\t\t\tel.add(attrName,value,start-1);\r\n\t\t\t\t\ts = S_ATTR_END;\r\n\t\t\t\t}else{\r\n\t\t\t\t\t//fatalError: no end quot match\r\n\t\t\t\t\tthrow new Error('attribute value no end \\''+c+'\\' match');\r\n\t\t\t\t}\r\n\t\t\t}else if(s == S_ATTR_NOQUOT_VALUE){\r\n\t\t\t\tvalue = source.slice(start,p).replace(/&#?\\w+;/g,entityReplacer);\r\n\t\t\t\t//console.log(attrName,value,start,p)\r\n\t\t\t\tel.add(attrName,value,start);\r\n\t\t\t\t//console.dir(el)\r\n\t\t\t\terrorHandler.warning('attribute \"'+attrName+'\" missed start quot('+c+')!!');\r\n\t\t\t\tstart = p+1;\r\n\t\t\t\ts = S_ATTR_END\r\n\t\t\t}else{\r\n\t\t\t\t//fatalError: no equal before\r\n\t\t\t\tthrow new Error('attribute value must after \"=\"');\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\tcase '/':\r\n\t\t\tswitch(s){\r\n\t\t\tcase S_TAG:\r\n\t\t\t\tel.setTagName(source.slice(start,p));\r\n\t\t\tcase S_ATTR_END:\r\n\t\t\tcase S_TAG_SPACE:\r\n\t\t\tcase S_TAG_CLOSE:\r\n\t\t\t\ts =S_TAG_CLOSE;\r\n\t\t\t\tel.closed = true;\r\n\t\t\tcase S_ATTR_NOQUOT_VALUE:\r\n\t\t\tcase S_ATTR:\r\n\t\t\tcase S_ATTR_SPACE:\r\n\t\t\t\tbreak;\r\n\t\t\t//case S_EQ:\r\n\t\t\tdefault:\r\n\t\t\t\tthrow new Error(\"attribute invalid close char('/')\")\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\tcase ''://end document\r\n\t\t\t//throw new Error('unexpected end of input')\r\n\t\t\terrorHandler.error('unexpected end of input');\r\n\t\t\tif(s == S_TAG){\r\n\t\t\t\tel.setTagName(source.slice(start,p));\r\n\t\t\t}\r\n\t\t\treturn p;\r\n\t\tcase '>':\r\n\t\t\tswitch(s){\r\n\t\t\tcase S_TAG:\r\n\t\t\t\tel.setTagName(source.slice(start,p));\r\n\t\t\tcase S_ATTR_END:\r\n\t\t\tcase S_TAG_SPACE:\r\n\t\t\tcase S_TAG_CLOSE:\r\n\t\t\t\tbreak;//normal\r\n\t\t\tcase S_ATTR_NOQUOT_VALUE://Compatible state\r\n\t\t\tcase S_ATTR:\r\n\t\t\t\tvalue = source.slice(start,p);\r\n\t\t\t\tif(value.slice(-1) === '/'){\r\n\t\t\t\t\tel.closed  = true;\r\n\t\t\t\t\tvalue = value.slice(0,-1)\r\n\t\t\t\t}\r\n\t\t\tcase S_ATTR_SPACE:\r\n\t\t\t\tif(s === S_ATTR_SPACE){\r\n\t\t\t\t\tvalue = attrName;\r\n\t\t\t\t}\r\n\t\t\t\tif(s == S_ATTR_NOQUOT_VALUE){\r\n\t\t\t\t\terrorHandler.warning('attribute \"'+value+'\" missed quot(\")!!');\r\n\t\t\t\t\tel.add(attrName,value.replace(/&#?\\w+;/g,entityReplacer),start)\r\n\t\t\t\t}else{\r\n\t\t\t\t\tif(currentNSMap[''] !== 'http://www.w3.org/1999/xhtml' || !value.match(/^(?:disabled|checked|selected)$/i)){\r\n\t\t\t\t\t\terrorHandler.warning('attribute \"'+value+'\" missed value!! \"'+value+'\" instead!!')\r\n\t\t\t\t\t}\r\n\t\t\t\t\tel.add(value,value,start)\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase S_EQ:\r\n\t\t\t\tthrow new Error('attribute value missed!!');\r\n\t\t\t}\r\n//\t\t\tconsole.log(tagName,tagNamePattern,tagNamePattern.test(tagName))\r\n\t\t\treturn p;\r\n\t\t/*xml space '\\x20' | #x9 | #xD | #xA; */\r\n\t\tcase '\\u0080':\r\n\t\t\tc = ' ';\r\n\t\tdefault:\r\n\t\t\tif(c<= ' '){//space\r\n\t\t\t\tswitch(s){\r\n\t\t\t\tcase S_TAG:\r\n\t\t\t\t\tel.setTagName(source.slice(start,p));//tagName\r\n\t\t\t\t\ts = S_TAG_SPACE;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase S_ATTR:\r\n\t\t\t\t\tattrName = source.slice(start,p)\r\n\t\t\t\t\ts = S_ATTR_SPACE;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase S_ATTR_NOQUOT_VALUE:\r\n\t\t\t\t\tvar value = source.slice(start,p).replace(/&#?\\w+;/g,entityReplacer);\r\n\t\t\t\t\terrorHandler.warning('attribute \"'+value+'\" missed quot(\")!!');\r\n\t\t\t\t\tel.add(attrName,value,start)\r\n\t\t\t\tcase S_ATTR_END:\r\n\t\t\t\t\ts = S_TAG_SPACE;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t//case S_TAG_SPACE:\r\n\t\t\t\t//case S_EQ:\r\n\t\t\t\t//case S_ATTR_SPACE:\r\n\t\t\t\t//\tvoid();break;\r\n\t\t\t\t//case S_TAG_CLOSE:\r\n\t\t\t\t\t//ignore warning\r\n\t\t\t\t}\r\n\t\t\t}else{//not space\r\n//S_TAG,\tS_ATTR,\tS_EQ,\tS_ATTR_NOQUOT_VALUE\r\n//S_ATTR_SPACE,\tS_ATTR_END,\tS_TAG_SPACE, S_TAG_CLOSE\r\n\t\t\t\tswitch(s){\r\n\t\t\t\t//case S_TAG:void();break;\r\n\t\t\t\t//case S_ATTR:void();break;\r\n\t\t\t\t//case S_ATTR_NOQUOT_VALUE:void();break;\r\n\t\t\t\tcase S_ATTR_SPACE:\r\n\t\t\t\t\tvar tagName =  el.tagName;\r\n\t\t\t\t\tif(currentNSMap[''] !== 'http://www.w3.org/1999/xhtml' || !attrName.match(/^(?:disabled|checked|selected)$/i)){\r\n\t\t\t\t\t\terrorHandler.warning('attribute \"'+attrName+'\" missed value!! \"'+attrName+'\" instead2!!')\r\n\t\t\t\t\t}\r\n\t\t\t\t\tel.add(attrName,attrName,start);\r\n\t\t\t\t\tstart = p;\r\n\t\t\t\t\ts = S_ATTR;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase S_ATTR_END:\r\n\t\t\t\t\terrorHandler.warning('attribute space is required\"'+attrName+'\"!!')\r\n\t\t\t\tcase S_TAG_SPACE:\r\n\t\t\t\t\ts = S_ATTR;\r\n\t\t\t\t\tstart = p;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase S_EQ:\r\n\t\t\t\t\ts = S_ATTR_NOQUOT_VALUE;\r\n\t\t\t\t\tstart = p;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase S_TAG_CLOSE:\r\n\t\t\t\t\tthrow new Error(\"elements closed character '/' and '>' must be connected to\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}//end outer switch\r\n\t\t//console.log('p++',p)\r\n\t\tp++;\r\n\t}\r\n}\r\n/**\r\n * @return true if has new namespace define\r\n */\r\nfunction appendElement(el,domBuilder,currentNSMap){\r\n\tvar tagName = el.tagName;\r\n\tvar localNSMap = null;\r\n\t//var currentNSMap = parseStack[parseStack.length-1].currentNSMap;\r\n\tvar i = el.length;\r\n\twhile(i--){\r\n\t\tvar a = el[i];\r\n\t\tvar qName = a.qName;\r\n\t\tvar value = a.value;\r\n\t\tvar nsp = qName.indexOf(':');\r\n\t\tif(nsp>0){\r\n\t\t\tvar prefix = a.prefix = qName.slice(0,nsp);\r\n\t\t\tvar localName = qName.slice(nsp+1);\r\n\t\t\tvar nsPrefix = prefix === 'xmlns' && localName\r\n\t\t}else{\r\n\t\t\tlocalName = qName;\r\n\t\t\tprefix = null\r\n\t\t\tnsPrefix = qName === 'xmlns' && ''\r\n\t\t}\r\n\t\t//can not set prefix,because prefix !== ''\r\n\t\ta.localName = localName ;\r\n\t\t//prefix == null for no ns prefix attribute \r\n\t\tif(nsPrefix !== false){//hack!!\r\n\t\t\tif(localNSMap == null){\r\n\t\t\t\tlocalNSMap = {}\r\n\t\t\t\t//console.log(currentNSMap,0)\r\n\t\t\t\t_copy(currentNSMap,currentNSMap={})\r\n\t\t\t\t//console.log(currentNSMap,1)\r\n\t\t\t}\r\n\t\t\tcurrentNSMap[nsPrefix] = localNSMap[nsPrefix] = value;\r\n\t\t\ta.uri = 'http://www.w3.org/2000/xmlns/'\r\n\t\t\tdomBuilder.startPrefixMapping(nsPrefix, value) \r\n\t\t}\r\n\t}\r\n\tvar i = el.length;\r\n\twhile(i--){\r\n\t\ta = el[i];\r\n\t\tvar prefix = a.prefix;\r\n\t\tif(prefix){//no prefix attribute has no namespace\r\n\t\t\tif(prefix === 'xml'){\r\n\t\t\t\ta.uri = 'http://www.w3.org/XML/1998/namespace';\r\n\t\t\t}if(prefix !== 'xmlns'){\r\n\t\t\t\ta.uri = currentNSMap[prefix || '']\r\n\t\t\t\t\r\n\t\t\t\t//{console.log('###'+a.qName,domBuilder.locator.systemId+'',currentNSMap,a.uri)}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tvar nsp = tagName.indexOf(':');\r\n\tif(nsp>0){\r\n\t\tprefix = el.prefix = tagName.slice(0,nsp);\r\n\t\tlocalName = el.localName = tagName.slice(nsp+1);\r\n\t}else{\r\n\t\tprefix = null;//important!!\r\n\t\tlocalName = el.localName = tagName;\r\n\t}\r\n\t//no prefix element has default namespace\r\n\tvar ns = el.uri = currentNSMap[prefix || ''];\r\n\tdomBuilder.startElement(ns,localName,tagName,el);\r\n\t//endPrefixMapping and startPrefixMapping have not any help for dom builder\r\n\t//localNSMap = null\r\n\tif(el.closed){\r\n\t\tdomBuilder.endElement(ns,localName,tagName);\r\n\t\tif(localNSMap){\r\n\t\t\tfor(prefix in localNSMap){\r\n\t\t\t\tdomBuilder.endPrefixMapping(prefix) \r\n\t\t\t}\r\n\t\t}\r\n\t}else{\r\n\t\tel.currentNSMap = currentNSMap;\r\n\t\tel.localNSMap = localNSMap;\r\n\t\t//parseStack.push(el);\r\n\t\treturn true;\r\n\t}\r\n}\r\nfunction parseHtmlSpecialContent(source,elStartEnd,tagName,entityReplacer,domBuilder){\r\n\tif(/^(?:script|textarea)$/i.test(tagName)){\r\n\t\tvar elEndStart =  source.indexOf('</'+tagName+'>',elStartEnd);\r\n\t\tvar text = source.substring(elStartEnd+1,elEndStart);\r\n\t\tif(/[&<]/.test(text)){\r\n\t\t\tif(/^script$/i.test(tagName)){\r\n\t\t\t\t//if(!/\\]\\]>/.test(text)){\r\n\t\t\t\t\t//lexHandler.startCDATA();\r\n\t\t\t\t\tdomBuilder.characters(text,0,text.length);\r\n\t\t\t\t\t//lexHandler.endCDATA();\r\n\t\t\t\t\treturn elEndStart;\r\n\t\t\t\t//}\r\n\t\t\t}//}else{//text area\r\n\t\t\t\ttext = text.replace(/&#?\\w+;/g,entityReplacer);\r\n\t\t\t\tdomBuilder.characters(text,0,text.length);\r\n\t\t\t\treturn elEndStart;\r\n\t\t\t//}\r\n\t\t\t\r\n\t\t}\r\n\t}\r\n\treturn elStartEnd+1;\r\n}\r\nfunction fixSelfClosed(source,elStartEnd,tagName,closeMap){\r\n\t//if(tagName in closeMap){\r\n\tvar pos = closeMap[tagName];\r\n\tif(pos == null){\r\n\t\t//console.log(tagName)\r\n\t\tpos =  source.lastIndexOf('</'+tagName+'>')\r\n\t\tif(pos<elStartEnd){//忘记闭合\r\n\t\t\tpos = source.lastIndexOf('</'+tagName)\r\n\t\t}\r\n\t\tcloseMap[tagName] =pos\r\n\t}\r\n\treturn pos<elStartEnd;\r\n\t//} \r\n}\r\nfunction _copy(source,target){\r\n\tfor(var n in source){target[n] = source[n]}\r\n}\r\nfunction parseDCC(source,start,domBuilder,errorHandler){//sure start with '<!'\r\n\tvar next= source.charAt(start+2)\r\n\tswitch(next){\r\n\tcase '-':\r\n\t\tif(source.charAt(start + 3) === '-'){\r\n\t\t\tvar end = source.indexOf('-->',start+4);\r\n\t\t\t//append comment source.substring(4,end)//<!--\r\n\t\t\tif(end>start){\r\n\t\t\t\tdomBuilder.comment(source,start+4,end-start-4);\r\n\t\t\t\treturn end+3;\r\n\t\t\t}else{\r\n\t\t\t\terrorHandler.error(\"Unclosed comment\");\r\n\t\t\t\treturn -1;\r\n\t\t\t}\r\n\t\t}else{\r\n\t\t\t//error\r\n\t\t\treturn -1;\r\n\t\t}\r\n\tdefault:\r\n\t\tif(source.substr(start+3,6) == 'CDATA['){\r\n\t\t\tvar end = source.indexOf(']]>',start+9);\r\n\t\t\tdomBuilder.startCDATA();\r\n\t\t\tdomBuilder.characters(source,start+9,end-start-9);\r\n\t\t\tdomBuilder.endCDATA() \r\n\t\t\treturn end+3;\r\n\t\t}\r\n\t\t//<!DOCTYPE\r\n\t\t//startDTD(java.lang.String name, java.lang.String publicId, java.lang.String systemId) \r\n\t\tvar matchs = split(source,start);\r\n\t\tvar len = matchs.length;\r\n\t\tif(len>1 && /!doctype/i.test(matchs[0][0])){\r\n\t\t\tvar name = matchs[1][0];\r\n\t\t\tvar pubid = len>3 && /^public$/i.test(matchs[2][0]) && matchs[3][0]\r\n\t\t\tvar sysid = len>4 && matchs[4][0];\r\n\t\t\tvar lastMatch = matchs[len-1]\r\n\t\t\tdomBuilder.startDTD(name,pubid && pubid.replace(/^(['\"])(.*?)\\1$/,'$2'),\r\n\t\t\t\t\tsysid && sysid.replace(/^(['\"])(.*?)\\1$/,'$2'));\r\n\t\t\tdomBuilder.endDTD();\r\n\t\t\t\r\n\t\t\treturn lastMatch.index+lastMatch[0].length\r\n\t\t}\r\n\t}\r\n\treturn -1;\r\n}\r\n\r\n\r\n\r\nfunction parseInstruction(source,start,domBuilder){\r\n\tvar end = source.indexOf('?>',start);\r\n\tif(end){\r\n\t\tvar match = source.substring(start,end).match(/^<\\?(\\S*)\\s*([\\s\\S]*?)\\s*$/);\r\n\t\tif(match){\r\n\t\t\tvar len = match[0].length;\r\n\t\t\tdomBuilder.processingInstruction(match[1], match[2]) ;\r\n\t\t\treturn end+2;\r\n\t\t}else{//error\r\n\t\t\treturn -1;\r\n\t\t}\r\n\t}\r\n\treturn -1;\r\n}\r\n\r\n/**\r\n * @param source\r\n */\r\nfunction ElementAttributes(source){\r\n\t\r\n}\r\nElementAttributes.prototype = {\r\n\tsetTagName:function(tagName){\r\n\t\tif(!tagNamePattern.test(tagName)){\r\n\t\t\tthrow new Error('invalid tagName:'+tagName)\r\n\t\t}\r\n\t\tthis.tagName = tagName\r\n\t},\r\n\tadd:function(qName,value,offset){\r\n\t\tif(!tagNamePattern.test(qName)){\r\n\t\t\tthrow new Error('invalid attribute:'+qName)\r\n\t\t}\r\n\t\tthis[this.length++] = {qName:qName,value:value,offset:offset}\r\n\t},\r\n\tlength:0,\r\n\tgetLocalName:function(i){return this[i].localName},\r\n\tgetLocator:function(i){return this[i].locator},\r\n\tgetQName:function(i){return this[i].qName},\r\n\tgetURI:function(i){return this[i].uri},\r\n\tgetValue:function(i){return this[i].value}\r\n//\t,getIndex:function(uri, localName)){\r\n//\t\tif(localName){\r\n//\t\t\t\r\n//\t\t}else{\r\n//\t\t\tvar qName = uri\r\n//\t\t}\r\n//\t},\r\n//\tgetValue:function(){return this.getValue(this.getIndex.apply(this,arguments))},\r\n//\tgetType:function(uri,localName){}\r\n//\tgetType:function(i){},\r\n}\r\n\r\n\r\n\r\n\r\nfunction _set_proto_(thiz,parent){\r\n\tthiz.__proto__ = parent;\r\n\treturn thiz;\r\n}\r\nif(!(_set_proto_({},_set_proto_.prototype) instanceof _set_proto_)){\r\n\t_set_proto_ = function(thiz,parent){\r\n\t\tfunction p(){};\r\n\t\tp.prototype = parent;\r\n\t\tp = new p();\r\n\t\tfor(parent in thiz){\r\n\t\t\tp[parent] = thiz[parent];\r\n\t\t}\r\n\t\treturn p;\r\n\t}\r\n}\r\n\r\nfunction split(source,start){\r\n\tvar match;\r\n\tvar buf = [];\r\n\tvar reg = /'[^']+'|\"[^\"]+\"|[^\\s<>\\/=]+=?|(\\/?\\s*>|<)/g;\r\n\treg.lastIndex = start;\r\n\treg.exec(source);//skip <\r\n\twhile(match = reg.exec(source)){\r\n\t\tbuf.push(match);\r\n\t\tif(match[1])return buf;\r\n\t}\r\n}\r\n\r\nexports.XMLReader = XMLReader;\r\n\r\n\n\n//# sourceURL=webpack:///./node_modules/xmldom/sax.js?");

/***/ }),

/***/ "./src/ad.js":
/*!*******************!*\
  !*** ./src/ad.js ***!
  \*******************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Ad = exports.Ad = function Ad() {\n  _classCallCheck(this, Ad);\n\n  this.id = null;\n  this.sequence = null;\n  this.system = null;\n  this.title = null;\n  this.description = null;\n  this.advertiser = null;\n  this.pricing = null;\n  this.survey = null;\n  this.errorURLTemplates = [];\n  this.impressionURLTemplates = [];\n  this.creatives = [];\n  this.extensions = [];\n};\n\n//# sourceURL=webpack:///./src/ad.js?");

/***/ }),

/***/ "./src/ad_extension.js":
/*!*****************************!*\
  !*** ./src/ad_extension.js ***!
  \*****************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar AdExtension = exports.AdExtension = function AdExtension() {\n  _classCallCheck(this, AdExtension);\n\n  this.attributes = {};\n  this.children = [];\n};\n\n//# sourceURL=webpack:///./src/ad_extension.js?");

/***/ }),

/***/ "./src/ad_extension_child.js":
/*!***********************************!*\
  !*** ./src/ad_extension_child.js ***!
  \***********************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar AdExtensionChild = exports.AdExtensionChild = function AdExtensionChild() {\n  _classCallCheck(this, AdExtensionChild);\n\n  this.name = null;\n  this.value = null;\n  this.attributes = {};\n};\n\n//# sourceURL=webpack:///./src/ad_extension_child.js?");

/***/ }),

/***/ "./src/companion_ad.js":
/*!*****************************!*\
  !*** ./src/companion_ad.js ***!
  \*****************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar CompanionAd = exports.CompanionAd = function CompanionAd() {\n  _classCallCheck(this, CompanionAd);\n\n  this.id = null;\n  this.width = 0;\n  this.height = 0;\n  this.type = null;\n  this.staticResource = null;\n  this.htmlResource = null;\n  this.iframeResource = null;\n  this.altText = null;\n  this.companionClickThroughURLTemplate = null;\n  this.companionClickTrackingURLTemplates = [];\n  this.trackingEvents = {};\n};\n\n//# sourceURL=webpack:///./src/companion_ad.js?");

/***/ }),

/***/ "./src/creative/creative.js":
/*!**********************************!*\
  !*** ./src/creative/creative.js ***!
  \**********************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Creative = exports.Creative = function Creative() {\n  var creativeAttributes = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n  _classCallCheck(this, Creative);\n\n  this.id = creativeAttributes.id || null;\n  this.adId = creativeAttributes.adId || null;\n  this.sequence = creativeAttributes.sequence || null;\n  this.apiFramework = creativeAttributes.apiFramework || null;\n  this.trackingEvents = {};\n};\n\n//# sourceURL=webpack:///./src/creative/creative.js?");

/***/ }),

/***/ "./src/creative/creative_companion.js":
/*!********************************************!*\
  !*** ./src/creative/creative_companion.js ***!
  \********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.CreativeCompanion = undefined;\n\nvar _creative = __webpack_require__(/*! ./creative */ \"./src/creative/creative.js\");\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar CreativeCompanion = exports.CreativeCompanion = function (_Creative) {\n  _inherits(CreativeCompanion, _Creative);\n\n  function CreativeCompanion() {\n    var creativeAttributes = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    _classCallCheck(this, CreativeCompanion);\n\n    var _this = _possibleConstructorReturn(this, (CreativeCompanion.__proto__ || Object.getPrototypeOf(CreativeCompanion)).call(this, creativeAttributes));\n\n    _this.type = 'companion';\n    _this.variations = [];\n    return _this;\n  }\n\n  return CreativeCompanion;\n}(_creative.Creative);\n\n//# sourceURL=webpack:///./src/creative/creative_companion.js?");

/***/ }),

/***/ "./src/creative/creative_linear.js":
/*!*****************************************!*\
  !*** ./src/creative/creative_linear.js ***!
  \*****************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.CreativeLinear = undefined;\n\nvar _creative = __webpack_require__(/*! ./creative */ \"./src/creative/creative.js\");\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar CreativeLinear = exports.CreativeLinear = function (_Creative) {\n  _inherits(CreativeLinear, _Creative);\n\n  function CreativeLinear() {\n    var creativeAttributes = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    _classCallCheck(this, CreativeLinear);\n\n    var _this = _possibleConstructorReturn(this, (CreativeLinear.__proto__ || Object.getPrototypeOf(CreativeLinear)).call(this, creativeAttributes));\n\n    _this.type = 'linear';\n    _this.duration = 0;\n    _this.skipDelay = null;\n    _this.mediaFiles = [];\n    _this.videoClickThroughURLTemplate = null;\n    _this.videoClickTrackingURLTemplates = [];\n    _this.videoCustomClickURLTemplates = [];\n    _this.adParameters = null;\n    _this.icons = [];\n    return _this;\n  }\n\n  return CreativeLinear;\n}(_creative.Creative);\n\n//# sourceURL=webpack:///./src/creative/creative_linear.js?");

/***/ }),

/***/ "./src/creative/creative_non_linear.js":
/*!*********************************************!*\
  !*** ./src/creative/creative_non_linear.js ***!
  \*********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.CreativeNonLinear = undefined;\n\nvar _creative = __webpack_require__(/*! ./creative */ \"./src/creative/creative.js\");\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar CreativeNonLinear = exports.CreativeNonLinear = function (_Creative) {\n  _inherits(CreativeNonLinear, _Creative);\n\n  function CreativeNonLinear() {\n    var creativeAttributes = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    _classCallCheck(this, CreativeNonLinear);\n\n    var _this = _possibleConstructorReturn(this, (CreativeNonLinear.__proto__ || Object.getPrototypeOf(CreativeNonLinear)).call(this, creativeAttributes));\n\n    _this.type = 'nonlinear';\n    _this.variations = [];\n    return _this;\n  }\n\n  return CreativeNonLinear;\n}(_creative.Creative);\n\n//# sourceURL=webpack:///./src/creative/creative_non_linear.js?");

/***/ }),

/***/ "./src/icon.js":
/*!*********************!*\
  !*** ./src/icon.js ***!
  \*********************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Icon = exports.Icon = function Icon() {\n  _classCallCheck(this, Icon);\n\n  this.program = null;\n  this.height = 0;\n  this.width = 0;\n  this.xPosition = 0;\n  this.yPosition = 0;\n  this.apiFramework = null;\n  this.offset = null;\n  this.duration = 0;\n  this.type = null;\n  this.staticResource = null;\n  this.htmlResource = null;\n  this.iframeResource = null;\n  this.iconClickThroughURLTemplate = null;\n  this.iconClickTrackingURLTemplates = [];\n  this.iconViewTrackingURLTemplate = null;\n};\n\n//# sourceURL=webpack:///./src/icon.js?");

/***/ }),

/***/ "./src/index.js":
/*!**********************!*\
  !*** ./src/index.js ***!
  \**********************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.VASTTracker = exports.VASTParser = exports.VASTClient = undefined;\n\nvar _vast_parser = __webpack_require__(/*! ./parser/vast_parser.js */ \"./src/parser/vast_parser.js\");\n\nvar _vast_client = __webpack_require__(/*! ./vast_client.js */ \"./src/vast_client.js\");\n\nvar _vast_tracker = __webpack_require__(/*! ./vast_tracker.js */ \"./src/vast_tracker.js\");\n\nexports.VASTClient = _vast_client.VASTClient;\nexports.VASTParser = _vast_parser.VASTParser;\nexports.VASTTracker = _vast_tracker.VASTTracker;\n\n//# sourceURL=webpack:///./src/index.js?");

/***/ }),

/***/ "./src/media_file.js":
/*!***************************!*\
  !*** ./src/media_file.js ***!
  \***************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar MediaFile = exports.MediaFile = function MediaFile() {\n  _classCallCheck(this, MediaFile);\n\n  this.id = null;\n  this.fileURL = null;\n  this.deliveryType = 'progressive';\n  this.mimeType = null;\n  this.codec = null;\n  this.bitrate = 0;\n  this.minBitrate = 0;\n  this.maxBitrate = 0;\n  this.width = 0;\n  this.height = 0;\n  this.apiFramework = null;\n  this.scalable = null;\n  this.maintainAspectRatio = null;\n};\n\n//# sourceURL=webpack:///./src/media_file.js?");

/***/ }),

/***/ "./src/non_linear_ad.js":
/*!******************************!*\
  !*** ./src/non_linear_ad.js ***!
  \******************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar NonLinearAd = exports.NonLinearAd = function NonLinearAd() {\n  _classCallCheck(this, NonLinearAd);\n\n  this.id = null;\n  this.width = 0;\n  this.height = 0;\n  this.expandedWidth = 0;\n  this.expandedHeight = 0;\n  this.scalable = true;\n  this.maintainAspectRatio = true;\n  this.minSuggestedDuration = 0;\n  this.apiFramework = 'static';\n  this.type = null;\n  this.staticResource = null;\n  this.htmlResource = null;\n  this.iframeResource = null;\n  this.nonlinearClickThroughURLTemplate = null;\n  this.nonlinearClickTrackingURLTemplates = [];\n  this.adParameters = null;\n};\n\n//# sourceURL=webpack:///./src/non_linear_ad.js?");

/***/ }),

/***/ "./src/parser/ad_parser.js":
/*!*********************************!*\
  !*** ./src/parser/ad_parser.js ***!
  \*********************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.AdParser = undefined;\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _ad = __webpack_require__(/*! ../ad */ \"./src/ad.js\");\n\nvar _ad_extension = __webpack_require__(/*! ../ad_extension */ \"./src/ad_extension.js\");\n\nvar _ad_extension_child = __webpack_require__(/*! ../ad_extension_child */ \"./src/ad_extension_child.js\");\n\nvar _creative_companion_parser = __webpack_require__(/*! ./creative_companion_parser */ \"./src/parser/creative_companion_parser.js\");\n\nvar _creative_linear_parser = __webpack_require__(/*! ./creative_linear_parser */ \"./src/parser/creative_linear_parser.js\");\n\nvar _creative_non_linear_parser = __webpack_require__(/*! ./creative_non_linear_parser */ \"./src/parser/creative_non_linear_parser.js\");\n\nvar _parser_utils = __webpack_require__(/*! ./parser_utils */ \"./src/parser/parser_utils.js\");\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n/**\n * This class provides methods to parse a VAST Ad Element.\n * @export\n * @class AdParser\n */\nvar AdParser = exports.AdParser = function () {\n  /**\n   * Creates an instance of AdParser.\n   */\n  function AdParser() {\n    _classCallCheck(this, AdParser);\n\n    this.creativeCompanionParser = new _creative_companion_parser.CreativeCompanionParser();\n    this.creativeNonLinearParser = new _creative_non_linear_parser.CreativeNonLinearParser();\n    this.creativeLinearParser = new _creative_linear_parser.CreativeLinearParser();\n    this.parserUtils = new _parser_utils.ParserUtils();\n  }\n\n  /**\n   * Parses an Ad element (can either be a Wrapper or an InLine).\n   * @param  {Object} adElement - The VAST Ad element to parse.\n   * @return {Ad}\n   */\n\n\n  _createClass(AdParser, [{\n    key: 'parse',\n    value: function parse(adElement) {\n      var childNodes = adElement.childNodes;\n\n      for (var adTypeElementKey in childNodes) {\n        var adTypeElement = childNodes[adTypeElementKey];\n\n        if (!['Wrapper', 'InLine'].includes(adTypeElement.nodeName)) {\n          continue;\n        }\n\n        this.parserUtils.copyNodeAttribute('id', adElement, adTypeElement);\n        this.parserUtils.copyNodeAttribute('sequence', adElement, adTypeElement);\n\n        if (adTypeElement.nodeName === 'Wrapper') {\n          return this.parseWrapper(adTypeElement);\n        } else if (adTypeElement.nodeName === 'InLine') {\n          return this.parseInLine(adTypeElement);\n        }\n      }\n    }\n\n    /**\n     * Parses an Inline element.\n     * @param  {Object} inLineElement - The VAST Inline element to parse.\n     * @return {Ad}\n     */\n\n  }, {\n    key: 'parseInLine',\n    value: function parseInLine(inLineElement) {\n      var _this = this;\n\n      var childNodes = inLineElement.childNodes;\n      var ad = new _ad.Ad();\n      ad.id = inLineElement.getAttribute('id') || null;\n      ad.sequence = inLineElement.getAttribute('sequence') || null;\n\n      for (var nodeKey in childNodes) {\n        var node = childNodes[nodeKey];\n\n        switch (node.nodeName) {\n          case 'Error':\n            ad.errorURLTemplates.push(this.parserUtils.parseNodeText(node));\n            break;\n\n          case 'Impression':\n            ad.impressionURLTemplates.push(this.parserUtils.parseNodeText(node));\n            break;\n\n          case 'Creatives':\n            this.parserUtils.childrenByName(node, 'Creative').forEach(function (creativeElement) {\n              var creativeAttributes = {\n                id: creativeElement.getAttribute('id') || null,\n                adId: _this.parseCreativeAdIdAttribute(creativeElement),\n                sequence: creativeElement.getAttribute('sequence') || null,\n                apiFramework: creativeElement.getAttribute('apiFramework') || null\n              };\n\n              for (var creativeTypeElementKey in creativeElement.childNodes) {\n                var creativeTypeElement = creativeElement.childNodes[creativeTypeElementKey];\n\n                switch (creativeTypeElement.nodeName) {\n                  case 'Linear':\n                    var creativeLinear = _this.creativeLinearParser.parse(creativeTypeElement, creativeAttributes);\n                    if (creativeLinear) {\n                      ad.creatives.push(creativeLinear);\n                    }\n                    break;\n                  case 'NonLinearAds':\n                    var creativeNonLinear = _this.creativeNonLinearParser.parse(creativeTypeElement, creativeAttributes);\n                    if (creativeNonLinear) {\n                      ad.creatives.push(creativeNonLinear);\n                    }\n                    break;\n                  case 'CompanionAds':\n                    var creativeCompanion = _this.creativeCompanionParser.parse(creativeTypeElement, creativeAttributes);\n                    if (creativeCompanion) {\n                      ad.creatives.push(creativeCompanion);\n                    }\n                    break;\n                }\n              }\n            });\n            break;\n\n          case 'Extensions':\n            this.parseExtensions(ad.extensions, this.parserUtils.childrenByName(node, 'Extension'));\n            break;\n\n          case 'AdSystem':\n            ad.system = {\n              value: this.parserUtils.parseNodeText(node),\n              version: node.getAttribute('version') || null\n            };\n            break;\n\n          case 'AdTitle':\n            ad.title = this.parserUtils.parseNodeText(node);\n            break;\n\n          case 'Description':\n            ad.description = this.parserUtils.parseNodeText(node);\n            break;\n\n          case 'Advertiser':\n            ad.advertiser = this.parserUtils.parseNodeText(node);\n            break;\n\n          case 'Pricing':\n            ad.pricing = {\n              value: this.parserUtils.parseNodeText(node),\n              model: node.getAttribute('model') || null,\n              currency: node.getAttribute('currency') || null\n            };\n            break;\n\n          case 'Survey':\n            ad.survey = this.parserUtils.parseNodeText(node);\n            break;\n        }\n      }\n\n      return ad;\n    }\n\n    /**\n     * Parses a Wrapper element without resolving the wrapped urls.\n     * @param  {Object} wrapperElement - The VAST Wrapper element to be parsed.\n     * @return {Ad}\n     */\n\n  }, {\n    key: 'parseWrapper',\n    value: function parseWrapper(wrapperElement) {\n      var ad = this.parseInLine(wrapperElement);\n      var wrapperURLElement = this.parserUtils.childByName(wrapperElement, 'VASTAdTagURI');\n\n      if (wrapperURLElement) {\n        ad.nextWrapperURL = this.parserUtils.parseNodeText(wrapperURLElement);\n      } else {\n        wrapperURLElement = this.parserUtils.childByName(wrapperElement, 'VASTAdTagURL');\n\n        if (wrapperURLElement) {\n          ad.nextWrapperURL = this.parserUtils.parseNodeText(this.parserUtils.childByName(wrapperURLElement, 'URL'));\n        }\n      }\n\n      ad.creatives.forEach(function (wrapperCreativeElement) {\n        if (['linear', 'nonlinear'].includes(wrapperCreativeElement.type)) {\n          // TrackingEvents Linear / NonLinear\n          if (wrapperCreativeElement.trackingEvents) {\n            if (!ad.trackingEvents) {\n              ad.trackingEvents = {};\n            }\n            if (!ad.trackingEvents[wrapperCreativeElement.type]) {\n              ad.trackingEvents[wrapperCreativeElement.type] = {};\n            }\n\n            var _loop = function _loop(eventName) {\n              var urls = wrapperCreativeElement.trackingEvents[eventName];\n              if (!ad.trackingEvents[wrapperCreativeElement.type][eventName]) {\n                ad.trackingEvents[wrapperCreativeElement.type][eventName] = [];\n              }\n              urls.forEach(function (url) {\n                ad.trackingEvents[wrapperCreativeElement.type][eventName].push(url);\n              });\n            };\n\n            for (var eventName in wrapperCreativeElement.trackingEvents) {\n              _loop(eventName);\n            }\n          }\n          // ClickTracking\n          if (wrapperCreativeElement.videoClickTrackingURLTemplates) {\n            if (!ad.videoClickTrackingURLTemplates) {\n              ad.videoClickTrackingURLTemplates = [];\n            } // tmp property to save wrapper tracking URLs until they are merged\n            wrapperCreativeElement.videoClickTrackingURLTemplates.forEach(function (item) {\n              ad.videoClickTrackingURLTemplates.push(item);\n            });\n          }\n          // ClickThrough\n          if (wrapperCreativeElement.videoClickThroughURLTemplate) {\n            ad.videoClickThroughURLTemplate = wrapperCreativeElement.videoClickThroughURLTemplate;\n          }\n          // CustomClick\n          if (wrapperCreativeElement.videoCustomClickURLTemplates) {\n            if (!ad.videoCustomClickURLTemplates) {\n              ad.videoCustomClickURLTemplates = [];\n            } // tmp property to save wrapper tracking URLs until they are merged\n            wrapperCreativeElement.videoCustomClickURLTemplates.forEach(function (item) {\n              ad.videoCustomClickURLTemplates.push(item);\n            });\n          }\n        }\n      });\n\n      if (ad.nextWrapperURL) {\n        return ad;\n      }\n    }\n\n    /**\n     * Parses an array of Extension elements.\n     * @param  {Array} collection - The array used to store the parsed extensions.\n     * @param  {Array} extensions - The array of extensions to parse.\n     */\n\n  }, {\n    key: 'parseExtensions',\n    value: function parseExtensions(collection, extensions) {\n      var _this2 = this;\n\n      extensions.forEach(function (extNode) {\n        var ext = new _ad_extension.AdExtension();\n        var extNodeAttrs = extNode.attributes;\n        var childNodes = extNode.childNodes;\n\n        if (extNode.attributes) {\n          for (var extNodeAttrKey in extNodeAttrs) {\n            var extNodeAttr = extNodeAttrs[extNodeAttrKey];\n\n            if (extNodeAttr.nodeName && extNodeAttr.nodeValue) {\n              ext.attributes[extNodeAttr.nodeName] = extNodeAttr.nodeValue;\n            }\n          }\n        }\n\n        for (var childNodeKey in childNodes) {\n          var childNode = childNodes[childNodeKey];\n          var txt = _this2.parserUtils.parseNodeText(childNode);\n\n          // ignore comments / empty value\n          if (childNode.nodeName !== '#comment' && txt !== '') {\n            var extChild = new _ad_extension_child.AdExtensionChild();\n            extChild.name = childNode.nodeName;\n            extChild.value = txt;\n\n            if (childNode.attributes) {\n              var childNodeAttributes = childNode.attributes;\n\n              for (var extChildNodeAttrKey in childNodeAttributes) {\n                var extChildNodeAttr = childNodeAttributes[extChildNodeAttrKey];\n\n                extChild.attributes[extChildNodeAttr.nodeName] = extChildNodeAttr.nodeValue;\n              }\n            }\n\n            ext.children.push(extChild);\n          }\n        }\n\n        collection.push(ext);\n      });\n    }\n\n    /**\n     * Parses the creative adId Attribute.\n     * @param  {any} creativeElement - The creative element to retrieve the adId from.\n     * @return {String|null}\n     */\n\n  }, {\n    key: 'parseCreativeAdIdAttribute',\n    value: function parseCreativeAdIdAttribute(creativeElement) {\n      return creativeElement.getAttribute('AdID') || // VAST 2 spec\n      creativeElement.getAttribute('adID') || // VAST 3 spec\n      creativeElement.getAttribute('adId') || // VAST 4 spec\n      null;\n    }\n  }]);\n\n  return AdParser;\n}();\n\n//# sourceURL=webpack:///./src/parser/ad_parser.js?");

/***/ }),

/***/ "./src/parser/creative_companion_parser.js":
/*!*************************************************!*\
  !*** ./src/parser/creative_companion_parser.js ***!
  \*************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.CreativeCompanionParser = undefined;\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _companion_ad = __webpack_require__(/*! ../companion_ad */ \"./src/companion_ad.js\");\n\nvar _creative_companion = __webpack_require__(/*! ../creative/creative_companion */ \"./src/creative/creative_companion.js\");\n\nvar _parser_utils = __webpack_require__(/*! ./parser_utils */ \"./src/parser/parser_utils.js\");\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n/**\n * This class provides methods to parse a VAST CompanionAd Element.\n * @export\n * @class CreativeCompanionParser\n */\nvar CreativeCompanionParser = exports.CreativeCompanionParser = function () {\n  /**\n   * Creates an instance of CreativeCompanionParser.\n   */\n  function CreativeCompanionParser() {\n    _classCallCheck(this, CreativeCompanionParser);\n\n    this.parserUtils = new _parser_utils.ParserUtils();\n  }\n\n  /**\n   * Parses a CompanionAd.\n   * @param  {Object} creativeElement - The VAST CompanionAd element to parse.\n   * @param  {Object} creativeAttributes - The attributes of the CompanionAd (optional).\n   * @return {CreativeCompanion}\n   */\n\n\n  _createClass(CreativeCompanionParser, [{\n    key: 'parse',\n    value: function parse(creativeElement, creativeAttributes) {\n      var _this = this;\n\n      var creative = new _creative_companion.CreativeCompanion(creativeAttributes);\n\n      this.parserUtils.childrenByName(creativeElement, 'Companion').forEach(function (companionResource) {\n        var companionAd = new _companion_ad.CompanionAd();\n        companionAd.id = companionResource.getAttribute('id') || null;\n        companionAd.width = companionResource.getAttribute('width');\n        companionAd.height = companionResource.getAttribute('height');\n        companionAd.companionClickTrackingURLTemplates = [];\n\n        _this.parserUtils.childrenByName(companionResource, 'HTMLResource').forEach(function (htmlElement) {\n          companionAd.type = htmlElement.getAttribute('creativeType') || 'text/html';\n          companionAd.htmlResource = _this.parserUtils.parseNodeText(htmlElement);\n        });\n\n        _this.parserUtils.childrenByName(companionResource, 'IFrameResource').forEach(function (iframeElement) {\n          companionAd.type = iframeElement.getAttribute('creativeType') || 0;\n          companionAd.iframeResource = _this.parserUtils.parseNodeText(iframeElement);\n        });\n\n        _this.parserUtils.childrenByName(companionResource, 'StaticResource').forEach(function (staticElement) {\n          companionAd.type = staticElement.getAttribute('creativeType') || 0;\n\n          _this.parserUtils.childrenByName(companionResource, 'AltText').forEach(function (child) {\n            companionAd.altText = _this.parserUtils.parseNodeText(child);\n          });\n\n          companionAd.staticResource = _this.parserUtils.parseNodeText(staticElement);\n        });\n\n        _this.parserUtils.childrenByName(companionResource, 'TrackingEvents').forEach(function (trackingEventsElement) {\n          _this.parserUtils.childrenByName(trackingEventsElement, 'Tracking').forEach(function (trackingElement) {\n            var eventName = trackingElement.getAttribute('event');\n            var trackingURLTemplate = _this.parserUtils.parseNodeText(trackingElement);\n            if (eventName && trackingURLTemplate) {\n              if (companionAd.trackingEvents[eventName] == null) {\n                companionAd.trackingEvents[eventName] = [];\n              }\n              companionAd.trackingEvents[eventName].push(trackingURLTemplate);\n            }\n          });\n        });\n\n        _this.parserUtils.childrenByName(companionResource, 'CompanionClickTracking').forEach(function (clickTrackingElement) {\n          companionAd.companionClickTrackingURLTemplates.push(_this.parserUtils.parseNodeText(clickTrackingElement));\n        });\n\n        companionAd.companionClickThroughURLTemplate = _this.parserUtils.parseNodeText(_this.parserUtils.childByName(companionResource, 'CompanionClickThrough'));\n        companionAd.companionClickTrackingURLTemplate = _this.parserUtils.parseNodeText(_this.parserUtils.childByName(companionResource, 'CompanionClickTracking'));\n        creative.variations.push(companionAd);\n      });\n\n      return creative;\n    }\n  }]);\n\n  return CreativeCompanionParser;\n}();\n\n//# sourceURL=webpack:///./src/parser/creative_companion_parser.js?");

/***/ }),

/***/ "./src/parser/creative_linear_parser.js":
/*!**********************************************!*\
  !*** ./src/parser/creative_linear_parser.js ***!
  \**********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.CreativeLinearParser = undefined;\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _creative_linear = __webpack_require__(/*! ../creative/creative_linear */ \"./src/creative/creative_linear.js\");\n\nvar _icon = __webpack_require__(/*! ../icon */ \"./src/icon.js\");\n\nvar _media_file = __webpack_require__(/*! ../media_file */ \"./src/media_file.js\");\n\nvar _parser_utils = __webpack_require__(/*! ./parser_utils */ \"./src/parser/parser_utils.js\");\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n/**\n * This class provides methods to parse a VAST Linear Element.\n * @export\n * @class CreativeLinearParser\n */\nvar CreativeLinearParser = exports.CreativeLinearParser = function () {\n  /**\n   * Creates an instance of CreativeLinearParser.\n   */\n  function CreativeLinearParser() {\n    _classCallCheck(this, CreativeLinearParser);\n\n    this.parserUtils = new _parser_utils.ParserUtils();\n  }\n\n  /**\n   * Parses a Linear element.\n   * @param  {Object} creativeElement - The VAST Linear element to parse.\n   * @param  {any} creativeAttributes - The attributes of the Linear (optional).\n   * @return {CreativeLinear}\n   */\n\n\n  _createClass(CreativeLinearParser, [{\n    key: 'parse',\n    value: function parse(creativeElement, creativeAttributes) {\n      var _this = this;\n\n      var offset = void 0;\n      var creative = new _creative_linear.CreativeLinear(creativeAttributes);\n\n      creative.duration = this.parserUtils.parseDuration(this.parserUtils.parseNodeText(this.parserUtils.childByName(creativeElement, 'Duration')));\n      var skipOffset = creativeElement.getAttribute('skipoffset');\n\n      if (skipOffset == null) {\n        creative.skipDelay = null;\n      } else if (skipOffset.charAt(skipOffset.length - 1) === '%' && creative.duration !== -1) {\n        var percent = parseInt(skipOffset, 10);\n        creative.skipDelay = creative.duration * (percent / 100);\n      } else {\n        creative.skipDelay = this.parserUtils.parseDuration(skipOffset);\n      }\n\n      var videoClicksElement = this.parserUtils.childByName(creativeElement, 'VideoClicks');\n      if (videoClicksElement) {\n        creative.videoClickThroughURLTemplate = this.parserUtils.parseNodeText(this.parserUtils.childByName(videoClicksElement, 'ClickThrough'));\n\n        this.parserUtils.childrenByName(videoClicksElement, 'ClickTracking').forEach(function (clickTrackingElement) {\n          creative.videoClickTrackingURLTemplates.push(_this.parserUtils.parseNodeText(clickTrackingElement));\n        });\n\n        this.parserUtils.childrenByName(videoClicksElement, 'CustomClick').forEach(function (customClickElement) {\n          creative.videoCustomClickURLTemplates.push(_this.parserUtils.parseNodeText(customClickElement));\n        });\n      }\n\n      var adParamsElement = this.parserUtils.childByName(creativeElement, 'AdParameters');\n      if (adParamsElement) {\n        creative.adParameters = this.parserUtils.parseNodeText(adParamsElement);\n      }\n\n      this.parserUtils.childrenByName(creativeElement, 'TrackingEvents').forEach(function (trackingEventsElement) {\n        _this.parserUtils.childrenByName(trackingEventsElement, 'Tracking').forEach(function (trackingElement) {\n          var eventName = trackingElement.getAttribute('event');\n          var trackingURLTemplate = _this.parserUtils.parseNodeText(trackingElement);\n          if (eventName && trackingURLTemplate) {\n            if (eventName === 'progress') {\n              offset = trackingElement.getAttribute('offset');\n              if (!offset) {\n                return;\n              }\n              if (offset.charAt(offset.length - 1) === '%') {\n                eventName = 'progress-' + offset;\n              } else {\n                eventName = 'progress-' + Math.round(_this.parserUtils.parseDuration(offset));\n              }\n            }\n\n            if (creative.trackingEvents[eventName] == null) {\n              creative.trackingEvents[eventName] = [];\n            }\n            creative.trackingEvents[eventName].push(trackingURLTemplate);\n          }\n        });\n      });\n\n      this.parserUtils.childrenByName(creativeElement, 'MediaFiles').forEach(function (mediaFilesElement) {\n        _this.parserUtils.childrenByName(mediaFilesElement, 'MediaFile').forEach(function (mediaFileElement) {\n          var mediaFile = new _media_file.MediaFile();\n          mediaFile.id = mediaFileElement.getAttribute('id');\n          mediaFile.fileURL = _this.parserUtils.parseNodeText(mediaFileElement);\n          mediaFile.deliveryType = mediaFileElement.getAttribute('delivery');\n          mediaFile.codec = mediaFileElement.getAttribute('codec');\n          mediaFile.mimeType = mediaFileElement.getAttribute('type');\n          mediaFile.apiFramework = mediaFileElement.getAttribute('apiFramework');\n          mediaFile.bitrate = parseInt(mediaFileElement.getAttribute('bitrate') || 0);\n          mediaFile.minBitrate = parseInt(mediaFileElement.getAttribute('minBitrate') || 0);\n          mediaFile.maxBitrate = parseInt(mediaFileElement.getAttribute('maxBitrate') || 0);\n          mediaFile.width = parseInt(mediaFileElement.getAttribute('width') || 0);\n          mediaFile.height = parseInt(mediaFileElement.getAttribute('height') || 0);\n\n          var scalable = mediaFileElement.getAttribute('scalable');\n          if (scalable && typeof scalable === 'string') {\n            scalable = scalable.toLowerCase();\n            if (scalable === 'true') {\n              mediaFile.scalable = true;\n            } else if (scalable === 'false') {\n              mediaFile.scalable = false;\n            }\n          }\n\n          var maintainAspectRatio = mediaFileElement.getAttribute('maintainAspectRatio');\n          if (maintainAspectRatio && typeof maintainAspectRatio === 'string') {\n            maintainAspectRatio = maintainAspectRatio.toLowerCase();\n            if (maintainAspectRatio === 'true') {\n              mediaFile.maintainAspectRatio = true;\n            } else if (maintainAspectRatio === 'false') {\n              mediaFile.maintainAspectRatio = false;\n            }\n          }\n\n          creative.mediaFiles.push(mediaFile);\n        });\n      });\n\n      var iconsElement = this.parserUtils.childByName(creativeElement, 'Icons');\n      if (iconsElement) {\n        this.parserUtils.childrenByName(iconsElement, 'Icon').forEach(function (iconElement) {\n          var icon = new _icon.Icon();\n          icon.program = iconElement.getAttribute('program');\n          icon.height = parseInt(iconElement.getAttribute('height') || 0);\n          icon.width = parseInt(iconElement.getAttribute('width') || 0);\n          icon.xPosition = _this.parseXPosition(iconElement.getAttribute('xPosition'));\n          icon.yPosition = _this.parseYPosition(iconElement.getAttribute('yPosition'));\n          icon.apiFramework = iconElement.getAttribute('apiFramework');\n          icon.offset = _this.parserUtils.parseDuration(iconElement.getAttribute('offset'));\n          icon.duration = _this.parserUtils.parseDuration(iconElement.getAttribute('duration'));\n\n          _this.parserUtils.childrenByName(iconElement, 'HTMLResource').forEach(function (htmlElement) {\n            icon.type = htmlElement.getAttribute('creativeType') || 'text/html';\n            icon.htmlResource = _this.parserUtils.parseNodeText(htmlElement);\n          });\n\n          _this.parserUtils.childrenByName(iconElement, 'IFrameResource').forEach(function (iframeElement) {\n            icon.type = iframeElement.getAttribute('creativeType') || 0;\n            icon.iframeResource = _this.parserUtils.parseNodeText(iframeElement);\n          });\n\n          _this.parserUtils.childrenByName(iconElement, 'StaticResource').forEach(function (staticElement) {\n            icon.type = staticElement.getAttribute('creativeType') || 0;\n            icon.staticResource = _this.parserUtils.parseNodeText(staticElement);\n          });\n\n          var iconClicksElement = _this.parserUtils.childByName(iconElement, 'IconClicks');\n          if (iconClicksElement) {\n            icon.iconClickThroughURLTemplate = _this.parserUtils.parseNodeText(_this.parserUtils.childByName(iconClicksElement, 'IconClickThrough'));\n            _this.parserUtils.childrenByName(iconClicksElement, 'IconClickTracking').forEach(function (iconClickTrackingElement) {\n              icon.iconClickTrackingURLTemplates.push(_this.parserUtils.parseNodeText(iconClickTrackingElement));\n            });\n          }\n\n          icon.iconViewTrackingURLTemplate = _this.parserUtils.parseNodeText(_this.parserUtils.childByName(iconElement, 'IconViewTracking'));\n\n          creative.icons.push(icon);\n        });\n      }\n\n      return creative;\n    }\n\n    /**\n     * Parses an horizontal position into a String ('left' or 'right') or into a Number.\n     * @param  {String} xPosition - The x position to parse.\n     * @return {String|Number}\n     */\n\n  }, {\n    key: 'parseXPosition',\n    value: function parseXPosition(xPosition) {\n      if (['left', 'right'].includes(xPosition)) {\n        return xPosition;\n      }\n\n      return parseInt(xPosition || 0);\n    }\n\n    /**\n     * Parses an vertical position into a String ('top' or 'bottom') or into a Number.\n     * @param  {String} yPosition - The x position to parse.\n     * @return {String|Number}\n     */\n\n  }, {\n    key: 'parseYPosition',\n    value: function parseYPosition(yPosition) {\n      if (['top', 'bottom'].includes(yPosition)) {\n        return yPosition;\n      }\n\n      return parseInt(yPosition || 0);\n    }\n  }]);\n\n  return CreativeLinearParser;\n}();\n\n//# sourceURL=webpack:///./src/parser/creative_linear_parser.js?");

/***/ }),

/***/ "./src/parser/creative_non_linear_parser.js":
/*!**************************************************!*\
  !*** ./src/parser/creative_non_linear_parser.js ***!
  \**************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.CreativeNonLinearParser = undefined;\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _creative_non_linear = __webpack_require__(/*! ../creative/creative_non_linear */ \"./src/creative/creative_non_linear.js\");\n\nvar _non_linear_ad = __webpack_require__(/*! ../non_linear_ad */ \"./src/non_linear_ad.js\");\n\nvar _parser_utils = __webpack_require__(/*! ./parser_utils */ \"./src/parser/parser_utils.js\");\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n/**\n * This class provides methods to parse a VAST NonLinear Element.\n * @export\n * @class CreativeNonLinearParser\n */\nvar CreativeNonLinearParser = exports.CreativeNonLinearParser = function () {\n  /**\n   * Creates an instance of CreativeNonLinearParser.\n   */\n  function CreativeNonLinearParser() {\n    _classCallCheck(this, CreativeNonLinearParser);\n\n    this.parserUtils = new _parser_utils.ParserUtils();\n  }\n\n  /**\n   * Parses a NonLinear element.\n   * @param  {any} creativeElement - The VAST NonLinear element to parse.\n   * @param  {any} creativeAttributes - The attributes of the NonLinear (optional).\n   * @return {CreativeNonLinear}\n   */\n\n\n  _createClass(CreativeNonLinearParser, [{\n    key: 'parse',\n    value: function parse(creativeElement, creativeAttributes) {\n      var _this = this;\n\n      var creative = new _creative_non_linear.CreativeNonLinear(creativeAttributes);\n\n      this.parserUtils.childrenByName(creativeElement, 'TrackingEvents').forEach(function (trackingEventsElement) {\n        var eventName = void 0,\n            trackingURLTemplate = void 0;\n        _this.parserUtils.childrenByName(trackingEventsElement, 'Tracking').forEach(function (trackingElement) {\n          eventName = trackingElement.getAttribute('event');\n          trackingURLTemplate = _this.parserUtils.parseNodeText(trackingElement);\n\n          if (eventName && trackingURLTemplate) {\n            if (creative.trackingEvents[eventName] == null) {\n              creative.trackingEvents[eventName] = [];\n            }\n            creative.trackingEvents[eventName].push(trackingURLTemplate);\n          }\n        });\n      });\n\n      this.parserUtils.childrenByName(creativeElement, 'NonLinear').forEach(function (nonlinearResource) {\n        var nonlinearAd = new _non_linear_ad.NonLinearAd();\n        nonlinearAd.id = nonlinearResource.getAttribute('id') || null;\n        nonlinearAd.width = nonlinearResource.getAttribute('width');\n        nonlinearAd.height = nonlinearResource.getAttribute('height');\n        nonlinearAd.expandedWidth = nonlinearResource.getAttribute('expandedWidth');\n        nonlinearAd.expandedHeight = nonlinearResource.getAttribute('expandedHeight');\n        nonlinearAd.scalable = _this.parserUtils.parseBoolean(nonlinearResource.getAttribute('scalable'));\n        nonlinearAd.maintainAspectRatio = _this.parserUtils.parseBoolean(nonlinearResource.getAttribute('maintainAspectRatio'));\n        nonlinearAd.minSuggestedDuration = _this.parserUtils.parseDuration(nonlinearResource.getAttribute('minSuggestedDuration'));\n        nonlinearAd.apiFramework = nonlinearResource.getAttribute('apiFramework');\n\n        _this.parserUtils.childrenByName(nonlinearResource, 'HTMLResource').forEach(function (htmlElement) {\n          nonlinearAd.type = htmlElement.getAttribute('creativeType') || 'text/html';\n          nonlinearAd.htmlResource = _this.parserUtils.parseNodeText(htmlElement);\n        });\n\n        _this.parserUtils.childrenByName(nonlinearResource, 'IFrameResource').forEach(function (iframeElement) {\n          nonlinearAd.type = iframeElement.getAttribute('creativeType') || 0;\n          nonlinearAd.iframeResource = _this.parserUtils.parseNodeText(iframeElement);\n        });\n\n        _this.parserUtils.childrenByName(nonlinearResource, 'StaticResource').forEach(function (staticElement) {\n          nonlinearAd.type = staticElement.getAttribute('creativeType') || 0;\n          nonlinearAd.staticResource = _this.parserUtils.parseNodeText(staticElement);\n        });\n\n        var adParamsElement = _this.parserUtils.childByName(nonlinearResource, 'AdParameters');\n        if (adParamsElement) {\n          nonlinearAd.adParameters = _this.parserUtils.parseNodeText(adParamsElement);\n        }\n\n        nonlinearAd.nonlinearClickThroughURLTemplate = _this.parserUtils.parseNodeText(_this.parserUtils.childByName(nonlinearResource, 'NonLinearClickThrough'));\n        _this.parserUtils.childrenByName(nonlinearResource, 'NonLinearClickTracking').forEach(function (clickTrackingElement) {\n          nonlinearAd.nonlinearClickTrackingURLTemplates.push(_this.parserUtils.parseNodeText(clickTrackingElement));\n        });\n\n        creative.variations.push(nonlinearAd);\n      });\n\n      return creative;\n    }\n  }]);\n\n  return CreativeNonLinearParser;\n}();\n\n//# sourceURL=webpack:///./src/parser/creative_non_linear_parser.js?");

/***/ }),

/***/ "./src/parser/parser_utils.js":
/*!************************************!*\
  !*** ./src/parser/parser_utils.js ***!
  \************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.ParserUtils = undefined;\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _util = __webpack_require__(/*! ../util/util */ \"./src/util/util.js\");\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n/**\n * This class provides support methods to the parsing classes.\n * @export\n * @class ParserUtils\n */\nvar ParserUtils = exports.ParserUtils = function () {\n  /**\n   * Creates an instance of ParserUtils.\n   */\n  function ParserUtils() {\n    _classCallCheck(this, ParserUtils);\n\n    this.util = new _util.Util();\n  }\n\n  /**\n   * Returns the first element of the given node which nodeName matches the given name.\n   * @param  {Object} node - The node to use to find a match.\n   * @param  {String} name - The name to look for.\n   * @return {Object}\n   */\n\n\n  _createClass(ParserUtils, [{\n    key: 'childByName',\n    value: function childByName(node, name) {\n      var childNodes = node.childNodes;\n\n      for (var childKey in childNodes) {\n        var child = childNodes[childKey];\n\n        if (child.nodeName === name) {\n          return child;\n        }\n      }\n    }\n\n    /**\n     * Returns all the elements of the given node which nodeName match the given name.\n     * @param  {any} node - The node to use to find the matches.\n     * @param  {any} name - The name to look for.\n     * @return {Array}\n     */\n\n  }, {\n    key: 'childrenByName',\n    value: function childrenByName(node, name) {\n      var children = [];\n      var childNodes = node.childNodes;\n\n      for (var childKey in childNodes) {\n        var child = childNodes[childKey];\n\n        if (child.nodeName === name) {\n          children.push(child);\n        }\n      }\n      return children;\n    }\n\n    /**\n     * Converts relative vastAdTagUri.\n     * @param  {String} vastAdTagUrl - The url to resolve.\n     * @param  {String} originalUrl - The original url.\n     * @return {String}\n     */\n\n  }, {\n    key: 'resolveVastAdTagURI',\n    value: function resolveVastAdTagURI(vastAdTagUrl, originalUrl) {\n      if (!originalUrl) {\n        return vastAdTagUrl;\n      }\n\n      if (vastAdTagUrl.indexOf('//') === 0) {\n        var _location = location,\n            protocol = _location.protocol;\n\n        return '' + protocol + vastAdTagUrl;\n      }\n\n      if (vastAdTagUrl.indexOf('://') === -1) {\n        // Resolve relative URLs (mainly for unit testing)\n        var baseURL = originalUrl.slice(0, originalUrl.lastIndexOf('/'));\n        return baseURL + '/' + vastAdTagUrl;\n      }\n\n      return vastAdTagUrl;\n    }\n\n    /**\n     * Converts a boolean string into a Boolean.\n     * @param  {String} booleanString - The boolean string to convert.\n     * @return {Boolean}\n     */\n\n  }, {\n    key: 'parseBoolean',\n    value: function parseBoolean(booleanString) {\n      return ['true', 'TRUE', '1'].includes(booleanString);\n    }\n\n    /**\n     * Parses a node text (for legacy support).\n     * @param  {Object} node - The node to parse the text from.\n     * @return {String}\n     */\n\n  }, {\n    key: 'parseNodeText',\n    value: function parseNodeText(node) {\n      return node && (node.textContent || node.text || '').trim();\n    }\n\n    /**\n     * Copies an attribute from a node to another.\n     * @param  {String} attributeName - The name of the attribute to clone.\n     * @param  {Object} nodeSource - The source node to copy the attribute from.\n     * @param  {Object} nodeDestination - The destination node to copy the attribute at.\n     */\n\n  }, {\n    key: 'copyNodeAttribute',\n    value: function copyNodeAttribute(attributeName, nodeSource, nodeDestination) {\n      var attributeValue = nodeSource.getAttribute(attributeName);\n      if (attributeValue) {\n        nodeDestination.setAttribute(attributeName, attributeValue);\n      }\n    }\n\n    /**\n     * Parses a String duration into a Number.\n     * @param  {String} durationString - The dureation represented as a string.\n     * @return {Number}\n     */\n\n  }, {\n    key: 'parseDuration',\n    value: function parseDuration(durationString) {\n      if (durationString == null) {\n        return -1;\n      }\n      // Some VAST doesn't have an HH:MM:SS duration format but instead jus the number of seconds\n      if (this.util.isNumeric(durationString)) {\n        return parseInt(durationString);\n      }\n\n      var durationComponents = durationString.split(':');\n      if (durationComponents.length !== 3) {\n        return -1;\n      }\n\n      var secondsAndMS = durationComponents[2].split('.');\n      var seconds = parseInt(secondsAndMS[0]);\n      if (secondsAndMS.length === 2) {\n        seconds += parseFloat('0.' + secondsAndMS[1]);\n      }\n\n      var minutes = parseInt(durationComponents[1] * 60);\n      var hours = parseInt(durationComponents[0] * 60 * 60);\n\n      if (isNaN(hours) || isNaN(minutes) || isNaN(seconds) || minutes > 60 * 60 || seconds > 60) {\n        return -1;\n      }\n      return hours + minutes + seconds;\n    }\n\n    /**\n     * Splits an Array of ads into an Array of Arrays of ads.\n     * Each subarray contains either one ad or multiple ads (an AdPod)\n     * @param  {Array} ads - An Array of ads to split\n     * @return {Array}\n     */\n\n  }, {\n    key: 'splitVAST',\n    value: function splitVAST(ads) {\n      var splittedVAST = [];\n      var lastAdPod = null;\n\n      ads.forEach(function (ad, i) {\n        if (ad.sequence) {\n          ad.sequence = parseInt(ad.sequence, 10);\n        }\n        // The current Ad may be the next Ad of an AdPod\n        if (ad.sequence > 1) {\n          var lastAd = ads[i - 1];\n          // check if the current Ad is exactly the next one in the AdPod\n          if (lastAd && lastAd.sequence === ad.sequence - 1) {\n            lastAdPod && lastAdPod.push(ad);\n            return;\n          }\n          // If the ad had a sequence attribute but it was not part of a correctly formed\n          // AdPod, let's remove the sequence attribute\n          delete ad.sequence;\n        }\n\n        lastAdPod = [ad];\n        splittedVAST.push(lastAdPod);\n      });\n\n      return splittedVAST;\n    }\n  }]);\n\n  return ParserUtils;\n}();\n\n//# sourceURL=webpack:///./src/parser/parser_utils.js?");

/***/ }),

/***/ "./src/parser/vast_parser.js":
/*!***********************************!*\
  !*** ./src/parser/vast_parser.js ***!
  \***********************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.VASTParser = undefined;\n\nvar _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _ad_parser = __webpack_require__(/*! ./ad_parser */ \"./src/parser/ad_parser.js\");\n\nvar _events = __webpack_require__(/*! events */ \"events\");\n\nvar _parser_utils = __webpack_require__(/*! ./parser_utils */ \"./src/parser/parser_utils.js\");\n\nvar _url_handler = __webpack_require__(/*! ../url_handler */ \"./src/url_handler.js\");\n\nvar _util = __webpack_require__(/*! ../util/util */ \"./src/util/util.js\");\n\nvar _vast_response = __webpack_require__(/*! ../vast_response */ \"./src/vast_response.js\");\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar DEFAULT_MAX_WRAPPER_DEPTH = 10;\nvar DEFAULT_EVENT_DATA = {\n  ERRORCODE: 900,\n  extensions: []\n};\n\n/**\n * This class provides methods to fetch and parse a VAST document.\n * @export\n * @class VASTParser\n * @extends EventEmitter\n */\n\nvar VASTParser = exports.VASTParser = function (_EventEmitter) {\n  _inherits(VASTParser, _EventEmitter);\n\n  /**\n   * Creates an instance of VASTParser.\n   * @constructor\n   */\n  function VASTParser() {\n    _classCallCheck(this, VASTParser);\n\n    var _this = _possibleConstructorReturn(this, (VASTParser.__proto__ || Object.getPrototypeOf(VASTParser)).call(this));\n\n    _this.remainingAds = [];\n    _this.parentURLs = [];\n    _this.errorURLTemplates = [];\n    _this.rootErrorURLTemplates = [];\n    _this.maxWrapperDepth = null;\n    _this.URLTemplateFilters = [];\n    _this.fetchingOptions = {};\n\n    _this.parserUtils = new _parser_utils.ParserUtils();\n    _this.adParser = new _ad_parser.AdParser();\n    _this.util = new _util.Util();\n    return _this;\n  }\n\n  /**\n   * Adds a filter function to the array of filters which are called before fetching a VAST document.\n   * @param  {function} filter - The filter function to be added at the end of the array.\n   * @return {void}\n   */\n\n\n  _createClass(VASTParser, [{\n    key: 'addURLTemplateFilter',\n    value: function addURLTemplateFilter(filter) {\n      if (typeof filter === 'function') {\n        this.URLTemplateFilters.push(filter);\n      }\n    }\n\n    /**\n     * Removes the last element of the url templates filters array.\n     * @return {void}\n     */\n\n  }, {\n    key: 'removeURLTemplateFilter',\n    value: function removeURLTemplateFilter() {\n      this.URLTemplateFilters.pop();\n    }\n\n    /**\n     * Returns the number of filters of the url templates filters array.\n     * @return {Number}\n     */\n\n  }, {\n    key: 'countURLTemplateFilters',\n    value: function countURLTemplateFilters() {\n      return this.URLTemplateFilters.length;\n    }\n\n    /**\n     * Removes all the filter functions from the url templates filters array.\n     * @return {void}\n     */\n\n  }, {\n    key: 'clearURLTemplateFilters',\n    value: function clearURLTemplateFilters() {\n      this.URLTemplateFilters = [];\n    }\n\n    /**\n     * Tracks the error provided in the errorCode parameter and emits a VAST-error event for the given error.\n     * @param  {Array} urlTemplates - An Array of url templates to use to make the tracking call.\n     * @param  {Object} errorCode - An Object containing the error data.\n     * @param  {Object} data - One (or more) Object containing additional data.\n     * @emits  VASTParser#VAST-error\n     * @return {void}\n     */\n\n  }, {\n    key: 'trackVastError',\n    value: function trackVastError(urlTemplates, errorCode) {\n      for (var _len = arguments.length, data = Array(_len > 2 ? _len - 2 : 0), _key = 2; _key < _len; _key++) {\n        data[_key - 2] = arguments[_key];\n      }\n\n      this.emit('VAST-error', _extends.apply(undefined, [DEFAULT_EVENT_DATA, errorCode].concat(data)));\n      this.util.track(urlTemplates, errorCode);\n    }\n\n    /**\n     * Returns an array of errorURLTemplates for the VAST being parsed.\n     * @return {Array}\n     */\n\n  }, {\n    key: 'getErrorURLTemplates',\n    value: function getErrorURLTemplates() {\n      return this.rootErrorURLTemplates.concat(this.errorURLTemplates);\n    }\n\n    /**\n     * Fetches a VAST document for the given url.\n     * Returns a Promise which resolves,rejects according to the result of the request.\n     * @param  {String} url - The url to request the VAST document.\n     * @emits  VASTParser#VAST-resolving\n     * @emits  VASTParser#VAST-resolved\n     * @return {Promise}\n     */\n\n  }, {\n    key: 'fetchVAST',\n    value: function fetchVAST(url) {\n      var _this2 = this;\n\n      return new Promise(function (resolve, reject) {\n        // Process url with defined filter\n        _this2.URLTemplateFilters.forEach(function (filter) {\n          url = filter(url);\n        });\n\n        _this2.parentURLs.push(url);\n        _this2.emit('VAST-resolving', { url: url });\n\n        _this2.urlHandler.get(url, _this2.fetchingOptions, function (err, xml) {\n          _this2.emit('VAST-resolved', { url: url });\n\n          if (err) {\n            reject(err);\n          } else {\n            resolve(xml);\n          }\n        });\n      });\n    }\n\n    /**\n     * Inits the parsing properties of the class with the custom values provided as options.\n     * @param {Object} options - The options to initialize a parsing sequence\n     */\n\n  }, {\n    key: 'initParsingStatus',\n    value: function initParsingStatus() {\n      var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n      this.rootURL = '';\n      this.remainingAds = [];\n      this.parentURLs = [];\n      this.errorURLTemplates = [];\n      this.rootErrorURLTemplates = [];\n      this.maxWrapperDepth = options.wrapperLimit || DEFAULT_MAX_WRAPPER_DEPTH;\n      this.fetchingOptions = {\n        timeout: options.timeout,\n        withCredentials: options.withCredentials\n      };\n\n      this.urlHandler = options.urlhandler || new _url_handler.URLHandler();\n    }\n\n    /**\n     * Resolves the next group of ads. If all is true resolves all the remaining ads.\n     * @param  {Boolean} all - If true all the remaining ads are resolved\n     * @return {Promise}\n     */\n\n  }, {\n    key: 'getRemainingAds',\n    value: function getRemainingAds(all) {\n      var _this3 = this;\n\n      return new Promise(function (resolve, reject) {\n        if (_this3.remainingAds.length === 0) {\n          reject(new Error('No more ads are available for the given VAST'));\n        }\n\n        var ads = all ? _this3.util.flatten(_this3.remainingAds) : _this3.remainingAds.shift();\n        _this3.errorURLTemplates = [];\n        _this3.parentURLs = [];\n\n        _this3.resolveAds(ads, { wrapperDepth: 0, originalUrl: _this3.rootURL }).then(function (resolvedAds) {\n          var response = _this3.buildVASTResponse(resolvedAds);\n\n          resolve(response);\n        }).catch(function (err) {\n          return reject(err);\n        });\n      });\n    }\n\n    /**\n     * Fetches and parses a VAST for the given url.\n     * Returns a Promise which resolves with a fully parsed VASTResponse or rejects with an Error.\n     * @param  {String} url - The url to request the VAST document.\n     * @param  {Object} options - An optional Object of parameters to be used in the parsing process.\n     * @emits  VASTParser#VAST-resolving\n     * @emits  VASTParser#VAST-resolved\n     * @return {Promise}\n     */\n\n  }, {\n    key: 'getAndParseVAST',\n    value: function getAndParseVAST(url) {\n      var _this4 = this;\n\n      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n      this.initParsingStatus(options);\n      this.rootURL = url;\n\n      return new Promise(function (resolve, reject) {\n        _this4.fetchVAST(url).then(function (xml) {\n          options.originalUrl = url;\n          options.isRootVAST = true;\n\n          _this4.parse(xml, options).then(function (ads) {\n            var response = _this4.buildVASTResponse(ads);\n\n            resolve(response);\n          }).catch(function (err) {\n            return reject(err);\n          });\n        }).catch(function (err) {\n          return reject(err);\n        });\n      });\n    }\n\n    /**\n     * Parses the given xml Object into a VASTResponse.\n     * Returns a Promise which resolves with a fully parsed VASTResponse or rejects with an Error.\n     * @param  {Object} vastXml - An object representing a vast xml document.\n     * @param  {Object} options - An optional Object of parameters to be used in the parsing process.\n     * @emits  VASTParser#VAST-resolving\n     * @emits  VASTParser#VAST-resolved\n     * @return {Promise}\n     */\n\n  }, {\n    key: 'parseVAST',\n    value: function parseVAST(vastXml) {\n      var _this5 = this;\n\n      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n      this.initParsingStatus(options);\n\n      return new Promise(function (resolve, reject) {\n        options.isRootVAST = true;\n\n        _this5.parse(vastXml, options).then(function (ads) {\n          var response = _this5.buildVASTResponse(ads);\n\n          resolve(response);\n        }).catch(function (err) {\n          return reject(err);\n        });\n      });\n    }\n\n    /**\n     * Builds a VASTResponse which can be returned.\n     * @param  {Array} ads - An Array of unwrapped ads\n     * @return {VASTResponse}\n     */\n\n  }, {\n    key: 'buildVASTResponse',\n    value: function buildVASTResponse(ads) {\n      var response = new _vast_response.VASTResponse();\n      response.ads = ads;\n      response.errorURLTemplates = this.getErrorURLTemplates();\n      this.completeWrapperResolving(response);\n\n      return response;\n    }\n\n    /**\n     * Parses the given xml Object into an array of ads\n     * Returns a Promise which resolves with the array or rejects with an error according to the result of the parsing.\n     * @param  {Object} vastXml - An object representing an xml document.\n     * @param  {Object} options - An optional Object of parameters to be used in the parsing process.\n     * @emits  VASTParser#VAST-resolving\n     * @emits  VASTParser#VAST-resolved\n     * @return {Promise}\n     */\n\n  }, {\n    key: 'parse',\n    value: function parse(vastXml, _ref) {\n      var _this6 = this;\n\n      var _ref$resolveAll = _ref.resolveAll,\n          resolveAll = _ref$resolveAll === undefined ? true : _ref$resolveAll,\n          _ref$wrapperSequence = _ref.wrapperSequence,\n          wrapperSequence = _ref$wrapperSequence === undefined ? null : _ref$wrapperSequence,\n          _ref$originalUrl = _ref.originalUrl,\n          originalUrl = _ref$originalUrl === undefined ? null : _ref$originalUrl,\n          _ref$wrapperDepth = _ref.wrapperDepth,\n          wrapperDepth = _ref$wrapperDepth === undefined ? 0 : _ref$wrapperDepth,\n          _ref$isRootVAST = _ref.isRootVAST,\n          isRootVAST = _ref$isRootVAST === undefined ? false : _ref$isRootVAST;\n\n      return new Promise(function (resolve, reject) {\n        // check if is a valid VAST document\n        if (!vastXml || !vastXml.documentElement || vastXml.documentElement.nodeName !== 'VAST') {\n          reject(new Error('Invalid VAST XMLDocument'));\n        }\n\n        var ads = [];\n        var childNodes = vastXml.documentElement.childNodes;\n\n        // Fill the VASTResponse object with ads and errorURLTemplates\n        for (var nodeKey in childNodes) {\n          var node = childNodes[nodeKey];\n\n          if (node.nodeName === 'Error') {\n            var errorURLTemplate = _this6.parserUtils.parseNodeText(node);\n\n            // Distinguish root VAST url templates from ad specific ones\n            isRootVAST ? _this6.rootErrorURLTemplates.push(errorURLTemplate) : _this6.errorURLTemplates.push(errorURLTemplate);\n          }\n\n          if (node.nodeName === 'Ad') {\n            var ad = _this6.adParser.parse(node);\n\n            if (ad) {\n              ads.push(ad);\n            } else {\n              // VAST version of response not supported.\n              _this6.trackVastError(_this6.getErrorURLTemplates(), {\n                ERRORCODE: 101\n              });\n            }\n          }\n        }\n\n        var adsCount = ads.length;\n        var lastAddedAd = ads[adsCount - 1];\n        // if in child nodes we have only one ads\n        // and wrapperSequence is defined\n        // and this ads doesn't already have sequence\n        if (adsCount === 1 && wrapperSequence !== undefined && wrapperSequence !== null && lastAddedAd && !lastAddedAd.sequence) {\n          lastAddedAd.sequence = wrapperSequence;\n        }\n\n        // Split the VAST in case we don't want to resolve everything at the first time\n        if (resolveAll === false) {\n          _this6.remainingAds = _this6.parserUtils.splitVAST(ads);\n          // Remove the first element from the remaining ads array, since we're going to resolve that element\n          ads = _this6.remainingAds.shift();\n        }\n\n        _this6.resolveAds(ads, { resolveAll: resolveAll, wrapperDepth: wrapperDepth, originalUrl: originalUrl }).then(function (res) {\n          return resolve(res);\n        }).catch(function (err) {\n          return reject(err);\n        });\n      });\n    }\n\n    /**\n     * Resolves an Array of ads, recursively calling itself with the remaining ads if a no ad\n     * response is returned for the given array.\n     * @param {Array} ads - An array of ads to resolve\n     * @param {Object} options - An options Object containing resolving parameters\n     * @return {Promise}\n     */\n\n  }, {\n    key: 'resolveAds',\n    value: function resolveAds() {\n      var _this7 = this;\n\n      var ads = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n      var _ref2 = arguments[1];\n      var wrapperDepth = _ref2.wrapperDepth,\n          originalUrl = _ref2.originalUrl;\n\n      return new Promise(function (resolve, reject) {\n        var resolveWrappersPromises = [];\n\n        ads.forEach(function (ad) {\n          var resolveWrappersPromise = _this7.resolveWrappers(ad, wrapperDepth, originalUrl);\n\n          resolveWrappersPromises.push(resolveWrappersPromise);\n        });\n\n        resolve(Promise.all(resolveWrappersPromises).then(function (unwrappedAds) {\n          return _this7.util.flatten(unwrappedAds);\n        }));\n      }).then(function (resolvedAds) {\n        if (!resolvedAds && _this7.remainingAds.length > 0) {\n          var _ads = _this7.remainingAds.shift();\n\n          return _this7.resolveAds(_ads, {\n            wrapperDepth: wrapperDepth,\n            originalUrl: originalUrl\n          });\n        }\n        return resolvedAds;\n      });\n    }\n\n    /**\n     * Resolves the wrappers for the given ad in a recursive way.\n     * Returns a Promise which resolves with the unwrapped ad or rejects with an error.\n     * @param  {Ad} ad - An ad to be unwrapped.\n     * @param  {Number} wrapperDepth - The reached depth in the wrapper resolving chain.\n     * @param  {String} originalUrl - The original vast url.\n     * @return {Promise}\n     */\n\n  }, {\n    key: 'resolveWrappers',\n    value: function resolveWrappers(ad, wrapperDepth, originalUrl) {\n      var _this8 = this;\n\n      return new Promise(function (resolve, reject) {\n        // Going one level deeper in the wrapper chain\n        wrapperDepth++;\n        // We already have a resolved VAST ad, no need to resolve wrapper\n        if (!ad.nextWrapperURL) {\n          resolve(ad);\n        }\n\n        if (wrapperDepth >= _this8.maxWrapperDepth || _this8.parentURLs.includes(ad.nextWrapperURL)) {\n          // Wrapper limit reached, as defined by the video player.\n          // Too many Wrapper responses have been received with no InLine response.\n          ad.errorCode = 302;\n          delete ad.nextWrapperURL;\n          resolve(ad);\n        }\n\n        // Get full URL\n        ad.nextWrapperURL = _this8.parserUtils.resolveVastAdTagURI(ad.nextWrapperURL, originalUrl);\n\n        // sequence doesn't carry over in wrapper element\n        var wrapperSequence = ad.sequence;\n        originalUrl = ad.nextWrapperURL;\n\n        _this8.fetchVAST(ad.nextWrapperURL).then(function (xml) {\n          _this8.parse(xml, { originalUrl: originalUrl, wrapperSequence: wrapperSequence, wrapperDepth: wrapperDepth }).then(function (unwrappedAds) {\n            delete ad.nextWrapperURL;\n            if (unwrappedAds.length === 0) {\n              // No ads returned by the wrappedResponse, discard current <Ad><Wrapper> creatives\n              ad.creatives = [];\n              resolve(ad);\n            }\n\n            unwrappedAds.forEach(function (unwrappedAd) {\n              if (unwrappedAd) {\n                _this8.mergeWrapperAdData(unwrappedAd, ad);\n              }\n            });\n\n            resolve(unwrappedAds);\n          }).catch(function (err) {\n            // Timeout of VAST URI provided in Wrapper element, or of VAST URI provided in a subsequent Wrapper element.\n            // (URI was either unavailable or reached a timeout as defined by the video player.)\n            ad.errorCode = 301;\n            ad.errorMessage = err.message;\n\n            resolve(ad);\n          });\n        }).catch(function (err) {\n          return reject(err);\n        });\n      });\n    }\n\n    /**\n     * Takes care of handling errors when the wrappers are resolved.\n     * @param {VASTResponse} vastResponse - A resolved VASTResponse.\n     */\n\n  }, {\n    key: 'completeWrapperResolving',\n    value: function completeWrapperResolving(vastResponse) {\n      // We've to wait for all <Ad> elements to be parsed before handling error so we can:\n      // - Send computed extensions data\n      // - Ping all <Error> URIs defined across VAST files\n\n      // No Ad case - The parser never bump into an <Ad> element\n      if (vastResponse.ads.length === 0) {\n        this.trackVastError(vastResponse.errorURLTemplates, { ERRORCODE: 303 });\n      } else {\n        for (var index = vastResponse.ads.length - 1; index >= 0; index--) {\n          // - Error encountred while parsing\n          // - No Creative case - The parser has dealt with soma <Ad><Wrapper> or/and an <Ad><Inline> elements\n          // but no creative was found\n          var ad = vastResponse.ads[index];\n          if (ad.errorCode || ad.creatives.length === 0) {\n            this.trackVastError(ad.errorURLTemplates.concat(vastResponse.errorURLTemplates), { ERRORCODE: ad.errorCode || 303 }, { ERRORMESSAGE: ad.errorMessage || '' }, { extensions: ad.extensions }, { system: ad.system });\n            vastResponse.ads.splice(index, 1);\n          }\n        }\n      }\n    }\n\n    /**\n     * Merges the data between an unwrapped ad and his wrapper.\n     * @param  {Ad} unwrappedAd - The 'unwrapped' Ad.\n     * @param  {Ad} wrapper - The wrapper Ad.\n     * @return {void}\n     */\n\n  }, {\n    key: 'mergeWrapperAdData',\n    value: function mergeWrapperAdData(unwrappedAd, wrapper) {\n      unwrappedAd.errorURLTemplates = wrapper.errorURLTemplates.concat(unwrappedAd.errorURLTemplates);\n      unwrappedAd.impressionURLTemplates = wrapper.impressionURLTemplates.concat(unwrappedAd.impressionURLTemplates);\n      unwrappedAd.extensions = wrapper.extensions.concat(unwrappedAd.extensions);\n\n      unwrappedAd.creatives.forEach(function (creative) {\n        if (wrapper.trackingEvents && wrapper.trackingEvents[creative.type]) {\n          for (var eventName in wrapper.trackingEvents[creative.type]) {\n            var urls = wrapper.trackingEvents[creative.type][eventName];\n            if (!creative.trackingEvents[eventName]) {\n              creative.trackingEvents[eventName] = [];\n            }\n            creative.trackingEvents[eventName] = creative.trackingEvents[eventName].concat(urls);\n          }\n        }\n      });\n\n      if (wrapper.videoClickTrackingURLTemplates && wrapper.videoClickTrackingURLTemplates.length) {\n        unwrappedAd.creatives.forEach(function (creative) {\n          if (creative.type === 'linear') {\n            creative.videoClickTrackingURLTemplates = creative.videoClickTrackingURLTemplates.concat(wrapper.videoClickTrackingURLTemplates);\n          }\n        });\n      }\n\n      if (wrapper.videoCustomClickURLTemplates && wrapper.videoCustomClickURLTemplates.length) {\n        unwrappedAd.creatives.forEach(function (creative) {\n          if (creative.type === 'linear') {\n            creative.videoCustomClickURLTemplates = creative.videoCustomClickURLTemplates.concat(wrapper.videoCustomClickURLTemplates);\n          }\n        });\n      }\n\n      // VAST 2.0 support - Use Wrapper/linear/clickThrough when Inline/Linear/clickThrough is null\n      if (wrapper.videoClickThroughURLTemplate) {\n        unwrappedAd.creatives.forEach(function (creative) {\n          if (creative.type === 'linear' && creative.videoClickThroughURLTemplate == null) {\n            creative.videoClickThroughURLTemplate = wrapper.videoClickThroughURLTemplate;\n          }\n        });\n      }\n    }\n  }]);\n\n  return VASTParser;\n}(_events.EventEmitter);\n\n//# sourceURL=webpack:///./src/parser/vast_parser.js?");

/***/ }),

/***/ "./src/url_handler.js":
/*!****************************!*\
  !*** ./src/url_handler.js ***!
  \****************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.URLHandler = undefined;\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _flash_url_handler = __webpack_require__(/*! ./urlhandlers/flash_url_handler */ \"./src/urlhandlers/flash_url_handler.js\");\n\nvar _node_url_handler = __webpack_require__(/*! ./urlhandlers/node_url_handler */ \"./src/urlhandlers/node_url_handler.js\");\n\nvar _xhr_url_handler = __webpack_require__(/*! ./urlhandlers/xhr_url_handler */ \"./src/urlhandlers/xhr_url_handler.js\");\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar URLHandler = exports.URLHandler = function () {\n  function URLHandler() {\n    _classCallCheck(this, URLHandler);\n\n    this.flash = new _flash_url_handler.FlashURLHandler();\n    this.node = new _node_url_handler.NodeURLHandler();\n    this.xhr = new _xhr_url_handler.XHRURLHandler();\n  }\n\n  _createClass(URLHandler, [{\n    key: 'get',\n    value: function get(url, options, cb) {\n      // Allow skip of the options param\n      if (!cb) {\n        if (typeof options === 'function') {\n          cb = options;\n        }\n        options = {};\n      }\n\n      if (options.response) {\n        // Trick: the VAST response XML document is passed as an option\n        var _options = options,\n            response = _options.response;\n\n        delete options.response;\n        return cb(null, response);\n      } else if (options.urlhandler && options.urlhandler.supported()) {\n        // explicitly supply your own URLHandler object\n        return options.urlhandler.get(url, options, cb);\n      } else if (typeof window === 'undefined' || window === null) {\n        return this.node.get(url, options, cb);\n      } else if (this.xhr.supported()) {\n        return this.xhr.get(url, options, cb);\n      } else if (this.flash.supported()) {\n        return this.flash.get(url, options, cb);\n      } else {\n        return cb(new Error('Current context is not supported by any of the default URLHandlers. Please provide a custom URLHandler'));\n      }\n    }\n  }]);\n\n  return URLHandler;\n}();\n\n//# sourceURL=webpack:///./src/url_handler.js?");

/***/ }),

/***/ "./src/urlhandlers/flash_url_handler.js":
/*!**********************************************!*\
  !*** ./src/urlhandlers/flash_url_handler.js ***!
  \**********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar FlashURLHandler = exports.FlashURLHandler = function () {\n  function FlashURLHandler() {\n    _classCallCheck(this, FlashURLHandler);\n  }\n\n  _createClass(FlashURLHandler, [{\n    key: 'xdr',\n    value: function xdr() {\n      var xdr = void 0;\n      if (window.XDomainRequest) {\n        xdr = new XDomainRequest();\n      }\n      return xdr;\n    }\n  }, {\n    key: 'supported',\n    value: function supported() {\n      return !!this.xdr();\n    }\n  }, {\n    key: 'get',\n    value: function get(url, options, cb) {\n      var xmlDocument = typeof window.ActiveXObject === 'function' ? new window.ActiveXObject('Microsoft.XMLDOM') : undefined;\n\n      if (xmlDocument) {\n        xmlDocument.async = false;\n      } else {\n        return cb(new Error('FlashURLHandler: Microsoft.XMLDOM format not supported'));\n      }\n\n      var xdr = this.xdr();\n      xdr.open('GET', url);\n      xdr.timeout = options.timeout || 0;\n      xdr.withCredentials = options.withCredentials || false;\n      xdr.send();\n      xdr.onprogress = function () {};\n\n      xdr.onload = function () {\n        xmlDocument.loadXML(xdr.responseText);\n        cb(null, xmlDocument);\n      };\n    }\n  }]);\n\n  return FlashURLHandler;\n}();\n\n//# sourceURL=webpack:///./src/urlhandlers/flash_url_handler.js?");

/***/ }),

/***/ "./src/urlhandlers/node_url_handler.js":
/*!*********************************************!*\
  !*** ./src/urlhandlers/node_url_handler.js ***!
  \*********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.NodeURLHandler = undefined;\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _url = __webpack_require__(/*! url */ \"url\");\n\nvar _url2 = _interopRequireDefault(_url);\n\nvar _fs = __webpack_require__(/*! fs */ \"fs\");\n\nvar _fs2 = _interopRequireDefault(_fs);\n\nvar _http = __webpack_require__(/*! http */ \"http\");\n\nvar _http2 = _interopRequireDefault(_http);\n\nvar _https = __webpack_require__(/*! https */ \"https\");\n\nvar _https2 = _interopRequireDefault(_https);\n\nvar _xmldom = __webpack_require__(/*! xmldom */ \"./node_modules/xmldom/dom-parser.js\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar NodeURLHandler = exports.NodeURLHandler = function () {\n  function NodeURLHandler() {\n    _classCallCheck(this, NodeURLHandler);\n  }\n\n  _createClass(NodeURLHandler, [{\n    key: 'get',\n    value: function get(url, options, cb) {\n      url = _url2.default.parse(url);\n      var httpModule = url.protocol === 'https:' ? _https2.default : _http2.default;\n      if (url.protocol === 'file:') {\n        _fs2.default.readFile(url.pathname, 'utf8', function (err, data) {\n          if (err) {\n            return cb(err);\n          }\n          var xml = new _xmldom.DOMParser().parseFromString(data);\n          cb(null, xml);\n        });\n      } else {\n        var timing = void 0;\n        var data = '';\n\n        var timeout_wrapper = function timeout_wrapper(req) {\n          return function () {\n            return req.abort();\n          };\n        };\n\n        var req = httpModule.get(url.href, function (res) {\n          res.on('data', function (chunk) {\n            var timing = void 0;\n            data += chunk;\n            clearTimeout(timing);\n            timing = setTimeout(_fn, options.timeout || 120000);\n          });\n          res.on('end', function () {\n            clearTimeout(timing);\n            var xml = new _xmldom.DOMParser().parseFromString(data);\n            cb(null, xml);\n          });\n        });\n\n        req.on('error', function (err) {\n          clearTimeout(timing);\n          cb(err);\n        });\n\n        var _fn = timeout_wrapper(req);\n        timing = setTimeout(_fn, options.timeout || 120000);\n      }\n    }\n  }]);\n\n  return NodeURLHandler;\n}();\n\n//# sourceURL=webpack:///./src/urlhandlers/node_url_handler.js?");

/***/ }),

/***/ "./src/urlhandlers/xhr_url_handler.js":
/*!********************************************!*\
  !*** ./src/urlhandlers/xhr_url_handler.js ***!
  \********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar XHRURLHandler = exports.XHRURLHandler = function () {\n  function XHRURLHandler() {\n    _classCallCheck(this, XHRURLHandler);\n  }\n\n  _createClass(XHRURLHandler, [{\n    key: 'xhr',\n    value: function xhr() {\n      var xhr = new window.XMLHttpRequest();\n      if ('withCredentials' in xhr) {\n        // check CORS support\n        return xhr;\n      }\n    }\n  }, {\n    key: 'supported',\n    value: function supported() {\n      return !!this.xhr();\n    }\n  }, {\n    key: 'get',\n    value: function get(url, options, cb) {\n      if (window.location.protocol === 'https:' && url.indexOf('http://') === 0) {\n        return cb(new Error('XHRURLHandler: Cannot go from HTTPS to HTTP.'));\n      }\n\n      try {\n        var xhr = this.xhr();\n        xhr.open('GET', url);\n        xhr.timeout = options.timeout || 0;\n        xhr.withCredentials = options.withCredentials || false;\n        xhr.overrideMimeType && xhr.overrideMimeType('text/xml');\n        xhr.onreadystatechange = function () {\n          if (xhr.readyState === 4) {\n            if (xhr.status === 200) {\n              cb(null, xhr.responseXML);\n            } else {\n              cb(new Error('XHRURLHandler: ' + xhr.statusText));\n            }\n          }\n        };\n        xhr.send();\n      } catch (error) {\n        cb(new Error('XHRURLHandler: Unexpected error'));\n      }\n    }\n  }]);\n\n  return XHRURLHandler;\n}();\n\n//# sourceURL=webpack:///./src/urlhandlers/xhr_url_handler.js?");

/***/ }),

/***/ "./src/util/storage.js":
/*!*****************************!*\
  !*** ./src/util/storage.js ***!
  \*****************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar storage = null;\n\n/**\n * This Object represents a default storage to be used in case no other storage is available.\n * @constant\n * @type {Object}\n */\nvar DEFAULT_STORAGE = {\n  data: {},\n  length: 0,\n  getItem: function getItem(key) {\n    return this.data[key];\n  },\n  setItem: function setItem(key, value) {\n    this.data[key] = value;\n    this.length = Object.keys(this.data).length;\n  },\n  removeItem: function removeItem(key) {\n    delete data[key];\n    this.length = Object.keys(this.data).length;\n  },\n  clear: function clear() {\n    this.data = {};\n    this.length = 0;\n  }\n};\n\n/**\n * This class provides an wrapper interface to the a key-value storage.\n * It uses localStorage, sessionStorage or a custom storage if none of the two is available.\n * @export\n * @class Storage\n */\n\nvar Storage = exports.Storage = function () {\n  /**\n   * Creates an instance of Storage.\n   * @constructor\n   */\n  function Storage() {\n    _classCallCheck(this, Storage);\n\n    this.storage = this.initStorage();\n  }\n\n  /**\n   * Provides a singleton instance of the wrapped storage.\n   * @return {Object}\n   */\n\n\n  _createClass(Storage, [{\n    key: 'initStorage',\n    value: function initStorage() {\n      if (storage) {\n        return storage;\n      }\n\n      try {\n        storage = typeof window !== 'undefined' && window !== null ? window.localStorage || window.sessionStorage : null;\n      } catch (storageError) {\n        storage = null;\n      }\n\n      if (!storage || this.isStorageDisabled(storage)) {\n        storage = DEFAULT_STORAGE;\n        storage.clear();\n      }\n\n      return storage;\n    }\n\n    /**\n     * Check if storage is disabled (like in certain cases with private browsing).\n     * In Safari (Mac + iOS) when private browsing is ON, localStorage is read only\n     * http://spin.atomicobject.com/2013/01/23/ios-private-browsing-localstorage/\n     * @param {Object} storage - The storage to check.\n     * @return {Boolean}\n     */\n\n  }, {\n    key: 'isStorageDisabled',\n    value: function isStorageDisabled(storage) {\n      var testValue = '__VASTStorage__';\n\n      try {\n        storage.setItem(testValue, testValue);\n        if (storage.getItem(testValue) !== testValue) {\n          storage.removeItem(testValue);\n          return true;\n        }\n      } catch (e) {\n        return true;\n      }\n      storage.removeItem(testValue);\n      return false;\n    }\n\n    /**\n     * Returns the value for the given key. If the key does not exist, null is returned.\n     * @param  {String} key - The key to retrieve the value.\n     * @return {any}\n     */\n\n  }, {\n    key: 'getItem',\n    value: function getItem(key) {\n      return this.storage.getItem(key);\n    }\n\n    /**\n     * Adds or updates the value for the given key.\n     * @param  {String} key - The key to modify the value.\n     * @param  {any} value - The value to be associated with the key.\n     * @return {any}\n     */\n\n  }, {\n    key: 'setItem',\n    value: function setItem(key, value) {\n      return this.storage.setItem(key, value);\n    }\n\n    /**\n     * Removes an item for the given key.\n     * @param  {String} key - The key to remove the value.\n     * @return {any}\n     */\n\n  }, {\n    key: 'removeItem',\n    value: function removeItem(key) {\n      return this.storage.removeItem(key);\n    }\n\n    /**\n     * Removes all the items from the storage.\n     */\n\n  }, {\n    key: 'clear',\n    value: function clear() {\n      return this.storage.clear();\n    }\n  }]);\n\n  return Storage;\n}();\n\n//# sourceURL=webpack:///./src/util/storage.js?");

/***/ }),

/***/ "./src/util/util.js":
/*!**************************!*\
  !*** ./src/util/util.js ***!
  \**************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Util = exports.Util = function () {\n  function Util() {\n    _classCallCheck(this, Util);\n  }\n\n  _createClass(Util, [{\n    key: 'track',\n    value: function track(URLTemplates, variables) {\n      var URLs = this.resolveURLTemplates(URLTemplates, variables);\n\n      URLs.forEach(function (URL) {\n        if (typeof window !== 'undefined' && window !== null) {\n          var i = new Image();\n          i.src = URL;\n        }\n      });\n    }\n  }, {\n    key: 'resolveURLTemplates',\n    value: function resolveURLTemplates(URLTemplates) {\n      var variables = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n      var URLs = [];\n\n      // Encode String variables, when given\n      if (variables['ASSETURI']) {\n        variables['ASSETURI'] = this.encodeURIComponentRFC3986(variables['ASSETURI']);\n      }\n      if (variables['CONTENTPLAYHEAD']) {\n        variables['CONTENTPLAYHEAD'] = this.encodeURIComponentRFC3986(variables['CONTENTPLAYHEAD']);\n      }\n\n      // Set default value for invalid ERRORCODE\n      if (variables['ERRORCODE'] && !/^[0-9]{3}$/.test(variables['ERRORCODE'])) {\n        variables['ERRORCODE'] = 900;\n      }\n\n      // Calc random/time based macros\n      variables['CACHEBUSTING'] = this.leftpad(Math.round(Math.random() * 1.0e8).toString());\n      variables['TIMESTAMP'] = this.encodeURIComponentRFC3986(new Date().toISOString());\n\n      // RANDOM/random is not defined in VAST 3/4 as a valid macro tho it's used by some adServer (Auditude)\n      variables['RANDOM'] = variables['random'] = variables['CACHEBUSTING'];\n\n      for (var URLTemplateKey in URLTemplates) {\n        var resolveURL = URLTemplates[URLTemplateKey];\n\n        if (!resolveURL) {\n          continue;\n        }\n\n        for (var key in variables) {\n          var value = variables[key];\n          var macro1 = '[' + key + ']';\n          var macro2 = '%%' + key + '%%';\n          resolveURL = resolveURL.replace(macro1, value);\n          resolveURL = resolveURL.replace(macro2, value);\n        }\n        URLs.push(resolveURL);\n      }\n\n      return URLs;\n    }\n\n    // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/encodeURIComponent\n\n  }, {\n    key: 'encodeURIComponentRFC3986',\n    value: function encodeURIComponentRFC3986(str) {\n      return encodeURIComponent(str).replace(/[!'()*]/g, function (c) {\n        return '%' + c.charCodeAt(0).toString(16);\n      });\n    }\n  }, {\n    key: 'leftpad',\n    value: function leftpad(str) {\n      if (str.length < 8) {\n        return this.range(0, 8 - str.length, false).map(function (i) {\n          return '0';\n        }).join('') + str;\n      } else {\n        return str;\n      }\n    }\n  }, {\n    key: 'range',\n    value: function range(left, right, inclusive) {\n      var range = [];\n      var ascending = left < right;\n      var end = !inclusive ? right : ascending ? right + 1 : right - 1;\n\n      for (var i = left; ascending ? i < end : i > end; ascending ? i++ : i--) {\n        range.push(i);\n      }\n      return range;\n    }\n  }, {\n    key: 'isNumeric',\n    value: function isNumeric(n) {\n      return !isNaN(parseFloat(n)) && isFinite(n);\n    }\n  }, {\n    key: 'flatten',\n    value: function flatten(arr) {\n      var _this = this;\n\n      return arr.reduce(function (flat, toFlatten) {\n        return flat.concat(Array.isArray(toFlatten) ? _this.flatten(toFlatten) : toFlatten);\n      }, []);\n    }\n  }]);\n\n  return Util;\n}();\n\n//# sourceURL=webpack:///./src/util/util.js?");

/***/ }),

/***/ "./src/vast_client.js":
/*!****************************!*\
  !*** ./src/vast_client.js ***!
  \****************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.VASTClient = undefined;\n\nvar _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _storage = __webpack_require__(/*! ./util/storage */ \"./src/util/storage.js\");\n\nvar _util = __webpack_require__(/*! ./util/util */ \"./src/util/util.js\");\n\nvar _vast_parser = __webpack_require__(/*! ./parser/vast_parser */ \"./src/parser/vast_parser.js\");\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n/**\n * This class provides methods to fetch and parse a VAST document using VASTParser.\n * In addition it provides options to skip consecutive calls based on constraints.\n * @export\n * @class VASTClient\n */\nvar VASTClient = exports.VASTClient = function () {\n  /**\n   * Creates an instance of VASTClient.\n   * @param  {Number} cappingFreeLunch - The number of first calls to skip.\n   * @param  {Number} cappingMinimumTimeInterval - The minimum time interval between two consecutive calls.\n   * @param  {Storage} customStorage - A custom storage to use instead of the default one.\n   * @constructor\n   */\n  function VASTClient(cappingFreeLunch, cappingMinimumTimeInterval, customStorage) {\n    _classCallCheck(this, VASTClient);\n\n    this.cappingFreeLunch = cappingFreeLunch || 0;\n    this.cappingMinimumTimeInterval = cappingMinimumTimeInterval || 0;\n    this.defaultOptions = {\n      withCredentials: false,\n      timeout: 0\n    };\n    this.vastParser = new _vast_parser.VASTParser();\n    this.util = new _util.Util();\n    this.storage = customStorage || new _storage.Storage();\n\n    // Init values if not already set\n    if (this.lastSuccessfulAd === undefined) {\n      this.lastSuccessfulAd = 0;\n    }\n\n    if (this.totalCalls === undefined) {\n      this.totalCalls = 0;\n    }\n    if (this.totalCallsTimeout === undefined) {\n      this.totalCallsTimeout = 0;\n    }\n  }\n\n  _createClass(VASTClient, [{\n    key: 'getParser',\n    value: function getParser() {\n      return this.vastParser;\n    }\n  }, {\n    key: 'hasRemainingAds',\n\n\n    /**\n     * Returns a boolean indicating if there are more ads to resolve for the current parsing.\n     * @return {Boolean}\n     */\n    value: function hasRemainingAds() {\n      return this.vastParser.remainingAds.length > 0;\n    }\n\n    /**\n     * Resolves the next group of ads. If all is true resolves all the remaining ads.\n     * @param  {Boolean} all - If true all the remaining ads are resolved\n     * @return {Promise}\n     */\n\n  }, {\n    key: 'getNextAds',\n    value: function getNextAds(all) {\n      return this.vastParser.getRemainingAds(all);\n    }\n\n    /**\n     * Gets a parsed VAST document for the given url, applying the skipping rules defined.\n     * Returns a Promise which resolves with a fully parsed VASTResponse or rejects with an Error.\n     * @param  {String} url - The url to use to fecth the VAST document.\n     * @param  {Object} options - An optional Object of parameters to be applied in the process.\n     * @return {Promise}\n     */\n\n  }, {\n    key: 'get',\n    value: function get(url) {\n      var _this = this;\n\n      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n      var now = Date.now();\n      options = _extends(this.defaultOptions, options);\n\n      // By default the client resolves only the first Ad or AdPod\n      if (!options.hasOwnProperty('resolveAll')) {\n        options.resolveAll = false;\n      }\n\n      // Check totalCallsTimeout (first call + 1 hour), if older than now,\n      // reset totalCalls number, by this way the client will be eligible again\n      // for freelunch capping\n      if (this.totalCallsTimeout < now) {\n        this.totalCalls = 1;\n        this.totalCallsTimeout = now + 60 * 60 * 1000;\n      } else {\n        this.totalCalls++;\n      }\n\n      return new Promise(function (resolve, reject) {\n        if (_this.cappingFreeLunch >= _this.totalCalls) {\n          reject(new Error('VAST call canceled \\u2013 FreeLunch capping not reached yet ' + _this.totalCalls + '/' + _this.cappingFreeLunch));\n        }\n\n        var timeSinceLastCall = now - _this.lastSuccessfulAd;\n\n        // Check timeSinceLastCall to be a positive number. If not, this mean the\n        // previous was made in the future. We reset lastSuccessfullAd value\n        if (timeSinceLastCall < 0) {\n          _this.lastSuccessfulAd = 0;\n        } else if (timeSinceLastCall < _this.cappingMinimumTimeInterval) {\n          reject(new Error('VAST call canceled \\u2013 (' + _this.cappingMinimumTimeInterval + ')ms minimum interval reached'));\n        }\n\n        _this.vastParser.getAndParseVAST(url, options).then(function (response) {\n          return resolve(response);\n        }).catch(function (err) {\n          return reject(err);\n        });\n      });\n    }\n  }, {\n    key: 'lastSuccessfulAd',\n    get: function get() {\n      return this.storage.getItem('vast-client-last-successful-ad');\n    },\n    set: function set(value) {\n      this.storage.setItem('vast-client-last-successful-ad', value);\n    }\n  }, {\n    key: 'totalCalls',\n    get: function get() {\n      return this.storage.getItem('vast-client-total-calls');\n    },\n    set: function set(value) {\n      this.storage.setItem('vast-client-total-calls', value);\n    }\n  }, {\n    key: 'totalCallsTimeout',\n    get: function get() {\n      return this.storage.getItem('vast-client-total-calls-timeout');\n    },\n    set: function set(value) {\n      this.storage.setItem('vast-client-total-calls-timeout', value);\n    }\n  }]);\n\n  return VASTClient;\n}();\n\n//# sourceURL=webpack:///./src/vast_client.js?");

/***/ }),

/***/ "./src/vast_response.js":
/*!******************************!*\
  !*** ./src/vast_response.js ***!
  \******************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar VASTResponse = exports.VASTResponse = function VASTResponse() {\n  _classCallCheck(this, VASTResponse);\n\n  this.ads = [];\n  this.errorURLTemplates = [];\n};\n\n//# sourceURL=webpack:///./src/vast_response.js?");

/***/ }),

/***/ "./src/vast_tracker.js":
/*!*****************************!*\
  !*** ./src/vast_tracker.js ***!
  \*****************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.VASTTracker = undefined;\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _companion_ad = __webpack_require__(/*! ./companion_ad */ \"./src/companion_ad.js\");\n\nvar _creative_linear = __webpack_require__(/*! ./creative/creative_linear */ \"./src/creative/creative_linear.js\");\n\nvar _events = __webpack_require__(/*! events */ \"events\");\n\nvar _non_linear_ad = __webpack_require__(/*! ./non_linear_ad */ \"./src/non_linear_ad.js\");\n\nvar _util = __webpack_require__(/*! ./util/util */ \"./src/util/util.js\");\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\n/**\n * This class provides methods to track an ad execution.\n *\n * @export\n * @class VASTTracker\n * @extends EventEmitter\n */\nvar VASTTracker = exports.VASTTracker = function (_EventEmitter) {\n  _inherits(VASTTracker, _EventEmitter);\n\n  /**\n   * Creates an instance of VASTTracker.\n   *\n   * @param {VASTClient} client - An instance of VASTClient that can be updated by the tracker. [optional]\n   * @param {Ad} ad - The ad to track.\n   * @param {Creative} creative - The creative to track.\n   * @param {CompanionAd|NonLinearAd} [variation=null] - An optional variation of the creative.\n   * @constructor\n   */\n  function VASTTracker(client, ad, creative) {\n    var variation = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;\n\n    _classCallCheck(this, VASTTracker);\n\n    var _this = _possibleConstructorReturn(this, (VASTTracker.__proto__ || Object.getPrototypeOf(VASTTracker)).call(this));\n\n    _this.ad = ad;\n    _this.creative = creative;\n    _this.variation = variation;\n    _this.util = new _util.Util();\n    _this.muted = false;\n    _this.impressed = false;\n    _this.skippable = false;\n    _this.skipDelayDefault = -1;\n    _this.trackingEvents = {};\n    // Tracker listeners should be notified with some events\n    // no matter if there is a tracking URL or not\n    _this.emitAlwaysEvents = ['creativeView', 'start', 'firstQuartile', 'midpoint', 'thirdQuartile', 'complete', 'resume', 'pause', 'rewind', 'skip', 'closeLinear', 'close'];\n    // Have to save already triggered quartile, to not trigger again\n    _this._alreadyTriggeredQuartiles = {};\n    // Duplicate the creative's trackingEvents property so we can alter it\n    for (var eventName in _this.creative.trackingEvents) {\n      var events = _this.creative.trackingEvents[eventName];\n      _this.trackingEvents[eventName] = events.slice(0);\n    }\n    if (_this.creative instanceof _creative_linear.CreativeLinear) {\n      _this.setDuration(_this.creative.duration);\n\n      _this.skipDelay = _this.creative.skipDelay;\n      _this.linear = true;\n      _this.clickThroughURLTemplate = _this.creative.videoClickThroughURLTemplate;\n      _this.clickTrackingURLTemplates = _this.creative.videoClickTrackingURLTemplates;\n      // Nonlinear and Companion\n    } else {\n      _this.skipDelay = -1;\n      _this.linear = false;\n      // Used variation has been specified\n      if (_this.variation) {\n        if (_this.variation instanceof _non_linear_ad.NonLinearAd) {\n          _this.clickThroughURLTemplate = _this.variation.nonlinearClickThroughURLTemplate;\n          _this.clickTrackingURLTemplates = _this.variation.nonlinearClickTrackingURLTemplates;\n        } else if (_this.variation instanceof _companion_ad.CompanionAd) {\n          _this.clickThroughURLTemplate = _this.variation.companionClickThroughURLTemplate;\n          _this.clickTrackingURLTemplates = _this.variation.companionClickTrackingURLTemplates;\n        }\n      }\n    }\n\n    // If the tracker is associated with a client we add a listener to the start event\n    // to update the lastSuccessfulAd property.\n    if (client) {\n      _this.on('start', function () {\n        client.lastSuccessfullAd = Date.now();\n      });\n    }\n    return _this;\n  }\n\n  /**\n   * Sets the duration of the ad and updates the quartiles based on that.\n   *\n   * @param  {Number} duration - The duration of the ad.\n   */\n\n\n  _createClass(VASTTracker, [{\n    key: 'setDuration',\n    value: function setDuration(duration) {\n      this.assetDuration = duration;\n      // beware of key names, theses are also used as event names\n      this.quartiles = {\n        firstQuartile: Math.round(25 * this.assetDuration) / 100,\n        midpoint: Math.round(50 * this.assetDuration) / 100,\n        thirdQuartile: Math.round(75 * this.assetDuration) / 100\n      };\n    }\n\n    /**\n     * Sets the duration of the ad and updates the quartiles based on that.\n     * This is required for tracking time related events.\n     *\n     * @param {Number} progress - Current playback time in seconds.\n     * @emits VASTTracker#start\n     * @emits VASTTracker#skip-countdown\n     * @emits VASTTracker#progress-[0-100]%\n     * @emits VASTTracker#progress-[currentTime]\n     * @emits VASTTracker#rewind\n     * @emits VASTTracker#firstQuartile\n     * @emits VASTTracker#midpoint\n     * @emits VASTTracker#thirdQuartile\n     */\n\n  }, {\n    key: 'setProgress',\n    value: function setProgress(progress) {\n      var _this2 = this;\n\n      var skipDelay = this.skipDelay || this.skipDelayDefault;\n\n      if (skipDelay !== -1 && !this.skippable) {\n        if (skipDelay > progress) {\n          this.emit('skip-countdown', skipDelay - progress);\n        } else {\n          this.skippable = true;\n          this.emit('skip-countdown', 0);\n        }\n      }\n\n      if (this.linear && this.assetDuration > 0) {\n        var events = [];\n\n        if (progress > 0) {\n          var percent = Math.round(progress / this.assetDuration * 100);\n\n          events.push('start');\n          events.push('progress-' + percent + '%');\n          events.push('progress-' + Math.round(progress));\n\n          for (var quartile in this.quartiles) {\n            if (this.isQuartileReached(quartile, this.quartiles[quartile], progress)) {\n              events.push(quartile);\n              this._alreadyTriggeredQuartiles[quartile] = true;\n            }\n          }\n        }\n\n        events.forEach(function (eventName) {\n          _this2.track(eventName, true);\n        });\n\n        if (progress < this.progress) {\n          this.track('rewind');\n        }\n      }\n\n      this.progress = progress;\n    }\n\n    /**\n     * Checks if a quartile has been reached without have being triggered already.\n     *\n     * @param {String} quartile - Quartile name\n     * @param {Number} time - Time offset, when this quartile is reached in seconds.\n     * @param {Number} progress - Current progress of the ads in seconds.\n     *\n     * @return {Boolean}\n     */\n\n  }, {\n    key: 'isQuartileReached',\n    value: function isQuartileReached(quartile, time, progress) {\n      var quartileReached = false;\n      // if quartile time already reached and never triggered\n      if (time <= progress && !this._alreadyTriggeredQuartiles[quartile]) {\n        quartileReached = true;\n      }\n      return quartileReached;\n    }\n\n    /**\n     * Updates the mute state and calls the mute/unmute tracking URLs.\n     *\n     * @param {Boolean} muted - Indicates if the video is muted or not.\n     * @emits VASTTracker#mute\n     * @emits VASTTracker#unmute\n     */\n\n  }, {\n    key: 'setMuted',\n    value: function setMuted(muted) {\n      if (this.muted !== muted) {\n        this.track(muted ? 'mute' : 'unmute');\n      }\n      this.muted = muted;\n    }\n\n    /**\n     * Update the pause state and call the resume/pause tracking URLs.\n     *\n     * @param {Boolean} paused - Indicates if the video is paused or not.\n     * @emits VASTTracker#pause\n     * @emits VASTTracker#resume\n     */\n\n  }, {\n    key: 'setPaused',\n    value: function setPaused(paused) {\n      if (this.paused !== paused) {\n        this.track(paused ? 'pause' : 'resume');\n      }\n      this.paused = paused;\n    }\n\n    /**\n     * Updates the fullscreen state and calls the fullscreen tracking URLs.\n     *\n     * @param {Boolean} fullscreen - Indicates if the video is in fulscreen mode or not.\n     * @emits VASTTracker#fullscreen\n     * @emits VASTTracker#exitFullscreen\n     */\n\n  }, {\n    key: 'setFullscreen',\n    value: function setFullscreen(fullscreen) {\n      if (this.fullscreen !== fullscreen) {\n        this.track(fullscreen ? 'fullscreen' : 'exitFullscreen');\n      }\n      this.fullscreen = fullscreen;\n    }\n\n    /**\n     * Updates the expand state and calls the expand/collapse tracking URLs.\n     *\n     * @param {Boolean} expanded - Indicates if the video is expanded or not.\n     * @emits VASTTracker#expand\n     * @emits VASTTracker#collapse\n     */\n\n  }, {\n    key: 'setExpand',\n    value: function setExpand(expanded) {\n      if (this.expanded !== expanded) {\n        this.track(expanded ? 'expand' : 'collapse');\n      }\n      this.expanded = expanded;\n    }\n\n    /**\n     * Must be called if you want to overwrite the <Linear> Skipoffset value.\n     * This will init the skip countdown duration. Then, every time setProgress() is called,\n     * it will decrease the countdown and emit a skip-countdown event with the remaining time.\n     * Do not call this method if you want to keep the original Skipoffset value.\n     *\n     * @param {Number} duration - The time in seconds until the skip button is displayed.\n     */\n\n  }, {\n    key: 'setSkipDelay',\n    value: function setSkipDelay(duration) {\n      if (typeof duration === 'number') {\n        this.skipDelay = duration;\n      }\n    }\n\n    /**\n     * Tracks an impression (can be called only once).\n     *\n     * @emits VASTTracker#creativeView\n     */\n\n  }, {\n    key: 'trackImpression',\n    value: function trackImpression() {\n      if (!this.impressed) {\n        this.impressed = true;\n        this.trackURLs(this.ad.impressionURLTemplates);\n        this.track('creativeView');\n      }\n    }\n\n    /**\n     * Send a request to the URI provided by the VAST <Error> element.\n     * If an [ERRORCODE] macro is included, it will be substitute with errorCode.\n     *\n     * @param {String} errorCode - Replaces [ERRORCODE] macro. [ERRORCODE] values are listed in the VAST specification.\n     */\n\n  }, {\n    key: 'errorWithCode',\n    value: function errorWithCode(errorCode) {\n      this.trackURLs(this.ad.errorURLTemplates, { ERRORCODE: errorCode });\n    }\n\n    /**\n     * Must be called when the user watched the linear creative until its end.\n     * Calls the complete tracking URLs.\n     *\n     * @emits VASTTracker#complete\n     */\n\n  }, {\n    key: 'complete',\n    value: function complete() {\n      this.track('complete');\n    }\n\n    /**\n     * Must be called when the player or the window is closed during the ad.\n     * Calls the `closeLinear` (in VAST 3.0) and `close` tracking URLs.\n     *\n     * @emits VASTTracker#closeLinear\n     * @emits VASTTracker#close\n     */\n\n  }, {\n    key: 'close',\n    value: function close() {\n      this.track(this.linear ? 'closeLinear' : 'close');\n    }\n\n    /**\n     * Must be called when the skip button is clicked. Calls the skip tracking URLs.\n     *\n     * @emits VASTTracker#skip\n     */\n\n  }, {\n    key: 'skip',\n    value: function skip() {\n      this.track('skip');\n      this.trackingEvents = [];\n    }\n\n    /**\n     * Must be called when the user clicks on the creative.\n     * It calls the tracking URLs and emits a 'clickthrough' event with the resolved\n     * clickthrough URL when done.\n     *\n     * @emits VASTTracker#clickthrough\n     */\n\n  }, {\n    key: 'click',\n    value: function click() {\n      if (this.clickTrackingURLTemplates && this.clickTrackingURLTemplates.length) {\n        this.trackURLs(this.clickTrackingURLTemplates);\n      }\n\n      if (this.clickThroughURLTemplate) {\n        var variables = this.linear ? { CONTENTPLAYHEAD: this.progressFormatted() } : {};\n        var clickThroughURL = this.util.resolveURLTemplates([this.clickThroughURLTemplate], variables)[0];\n\n        this.emit('clickthrough', clickThroughURL);\n      }\n    }\n\n    /**\n     * Calls the tracking URLs for the given eventName and emits the event.\n     *\n     * @param {String} eventName - The name of the event.\n     * @param {Boolean} [once=false] - Boolean to define if the event has to be tracked only once.\n     */\n\n  }, {\n    key: 'track',\n    value: function track(eventName) {\n      var once = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n\n      // closeLinear event was introduced in VAST 3.0\n      // Fallback to vast 2.0 close event if necessary\n      if (eventName === 'closeLinear' && !this.trackingEvents[eventName] && this.trackingEvents['close']) {\n        eventName = 'close';\n      }\n\n      var trackingURLTemplates = this.trackingEvents[eventName];\n      var isAlwaysEmitEvent = this.emitAlwaysEvents.indexOf(eventName) > -1;\n\n      if (trackingURLTemplates) {\n        this.emit(eventName, '');\n        this.trackURLs(trackingURLTemplates);\n      } else if (isAlwaysEmitEvent) {\n        this.emit(eventName, '');\n      }\n\n      if (once) {\n        delete this.trackingEvents[eventName];\n        if (isAlwaysEmitEvent) {\n          this.emitAlwaysEvents.splice(this.emitAlwaysEvents.indexOf(eventName), 1);\n        }\n      }\n    }\n\n    /**\n     * Calls the tracking urls templates with the given variables.\n     *\n     * @param {Array} URLTemplates - An array of tracking url templates.\n     * @param {Object} [variables={}] - An optional Object of parameters to be used in the tracking calls.\n     */\n\n  }, {\n    key: 'trackURLs',\n    value: function trackURLs(URLTemplates) {\n      var variables = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n      if (this.linear) {\n        if (this.creative && this.creative.mediaFiles && this.creative.mediaFiles[0] && this.creative.mediaFiles[0].fileURL) {\n          variables['ASSETURI'] = this.creative.mediaFiles[0].fileURL;\n        }\n        variables['CONTENTPLAYHEAD'] = this.progressFormatted();\n      }\n\n      this.util.track(URLTemplates, variables);\n    }\n\n    /**\n     * Formats time progress in a readable string.\n     *\n     * @return {String}\n     */\n\n  }, {\n    key: 'progressFormatted',\n    value: function progressFormatted() {\n      var seconds = parseInt(this.progress);\n      var h = seconds / (60 * 60);\n      if (h.length < 2) {\n        h = '0' + h;\n      }\n      var m = seconds / 60 % 60;\n      if (m.length < 2) {\n        m = '0' + m;\n      }\n      var s = seconds % 60;\n      if (s.length < 2) {\n        s = '0' + m;\n      }\n      var ms = parseInt((this.progress - seconds) * 100);\n      return h + ':' + m + ':' + s + '.' + ms;\n    }\n  }]);\n\n  return VASTTracker;\n}(_events.EventEmitter);\n\n//# sourceURL=webpack:///./src/vast_tracker.js?");

/***/ }),

/***/ "events":
/*!*************************!*\
  !*** external "events" ***!
  \*************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("module.exports = require(\"events\");\n\n//# sourceURL=webpack:///external_%22events%22?");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("module.exports = require(\"fs\");\n\n//# sourceURL=webpack:///external_%22fs%22?");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("module.exports = require(\"http\");\n\n//# sourceURL=webpack:///external_%22http%22?");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("module.exports = require(\"https\");\n\n//# sourceURL=webpack:///external_%22https%22?");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("module.exports = require(\"url\");\n\n//# sourceURL=webpack:///external_%22url%22?");

/***/ })

/******/ });
});